(()=>{"use strict";var e="/dungeon-game/";const t={floorTexture:e+"assets/b5aaed81ca2d1042f9a1.png",wallTexture:e+"assets/1ff0e9fd7756fa67a6e3.jpg",playerTexture:e+"assets/36842061eecde0146548.png",enemyTexture:e+"assets/c2abb91c965fee2c144b.png",bloodTexture:e+"assets/aad741dfe71af677f795.png",aidKitTexture:e+"assets/79e186c8dd3fba9deccb.png",gogglesTexture:e+"assets/731b2b0db1a708ca3175.png",heartTexture:e+"assets/502866806875110ceeae.png",bulletSound:e+"assets/5d47cbddfd7640ba29a0.ogg",torchSound:e+"assets/ac5ce9bd2dc980bf1754.ogg",gameOverSound:e+"assets/81f4739e205d4712bde7.ogg",playerHurtSound:e+"assets/0aaf114e55619a91fd22.ogg",playerDeadSound:e+"assets/f7f66f7a50db67b654e0.ogg",enemyHurtSound:e+"assets/a5236b0656b6d63f174a.ogg",playerBulletRechargeSound:e+"assets/671b1542dbb4caf26fa4.ogg",bonusPickupSound:e+"assets/a0eba45f5e6c41de422f.ogg",spawnSound:e+"assets/912af0db42bb5d4e3612.ogg"};class i{_x;_y;constructor(e,t){this._x=e,this._y=t}get x(){return this._x}get y(){return this._y}toString(){return`(${this._x.toFixed(2)}, ${this._y.toFixed(2)})`}equals(e){return this._x===e.x&&this._y===e.y}clone(){return new i(this._x,this._y)}setTo(e,t){return this._x=e,this._y=t,this}setToPointCoordinates(e){return this.setTo(e.x,e.y)}moveBy(e,t){return this._x+=e,this._y+=t,this}movedBy(e,t){return this.clone().moveBy(e,t)}moveByPointCoordinates(e){return this.moveBy(e.x,e.y)}movedByPointCoordinates(e){return this.clone().moveByPointCoordinates(e)}invertAgainstPointCoordinates(e){return this.moveBy(2*(e.x-this._x),2*(e.y-this._y))}invertedAgainstPointCoordinates(e){return this.clone().invertAgainstPointCoordinates(e)}invert(){return this.invertAgainstPointCoordinates(new i(0,0))}inverted(){return this.clone().invert()}rotateAroundPointCoordinates(e,t){const i=Math.cos(t*Math.PI/180),s=Math.sin(t*Math.PI/180),n=this._x-e._x,r=this._y-e.y;return this._x=n*i-r*s+e._x,this._y=n*s+r*i+e.y,this}rotatedAroundPointCoordinates(e,t){return this.clone().rotateAroundPointCoordinates(e,t)}rotate(e){return this.rotateAroundPointCoordinates(new i(0,0),e)}rotated(e){return this.clone().rotate(e)}distanceTo(e){return Math.sqrt((this._x-e.x)**2+(this.y-e.y)**2)}}const s="https://dungeon-game-go.onrender.com",n=`${s}/api/v1`,r=1280,a=720,o="Texturina",l="#000000E6",h=new i(31,26),d=new i(22,56),c=new i(39,47),u=new i(31,26),f=new i(31,60),g={FLOOR:t.floorTexture,WALL:t.wallTexture,PLAYER:t.playerTexture,ENEMY:t.enemyTexture,BLOOD:t.bloodTexture,AID_KIT:t.aidKitTexture,GOGGLES:t.gogglesTexture,HEART:t.heartTexture},m={BULLET:t.bulletSound,TORCH:t.torchSound,GAME_OVER:t.gameOverSound,PLAYER_HURT:t.playerHurtSound,PLAYER_DEAD:t.playerDeadSound,ENEMY_HURT:t.enemyHurtSound,PLAYER_BULLET_RECHARGE:t.playerBulletRechargeSound,BONUS_PICKUP:t.bonusPickupSound,SPAWN:t.spawnSound},p={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let y;const w=new Uint8Array(16);function b(){if(!y){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");y=crypto.getRandomValues.bind(crypto)}return y(w)}const k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));const _=function(e,t,i){if(p.randomUUID&&!t&&!e)return p.randomUUID();const s=(e=e||{}).random||(e.rng||b)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=s[e];return t}return function(e,t=0){return(k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]).toLowerCase()}(s)};class T{_point;_width;_height;_id;static _objectNumber=0;static get objectCount(){return T._objectNumber}get id(){return this._id}constructor(e,t,i,s=_()){this._point=e,this._width=t,this._height=i,this._id=s,T._objectNumber++}get x(){return this._point.x}get y(){return this._point.y}get width(){return this._width}get height(){return this._height}getPosition(){return this._point}moveBy(e,t){this._point.moveBy(e,t)}getCollisionRect(e=0,t=0){return{left:this.x-this.width/2+e,top:this.y-this.height/2+t,width:this.width,height:this.height}}checkCollision(e,t,i,s){const n=this.getCollisionRect();return n.left<e+i&&n.left+n.width>e&&n.top<t+s&&n.top+n.height>t}checkCollisionWithObject(e){const t=e.getCollisionRect();return this.checkCollision(t.left,t.top,t.width,t.height)}}function v(e){return new Promise(((t,i)=>{const s=new Image;s.onload=()=>t(s),s.onerror=t=>i(new Error(`Failed to load image: ${e}`)),s.src=e}))}class S{static instance;audioContext;soundBuffers;loadingPromises;activeSources=new Map;constructor(){this.audioContext=new AudioContext,this.soundBuffers=new Map,this.loadingPromises=new Map}static getInstance(){return S.instance||(S.instance=new S),S.instance}async loadSound(e){if(this.soundBuffers.has(e)||this.loadingPromises.has(e))return;const t=fetch(e).then((e=>e.arrayBuffer())).then((e=>this.audioContext.decodeAudioData(e))).then((t=>{this.soundBuffers.set(e,t)}));this.loadingPromises.set(e,t),await t}playSound(e,t=1,i=!1){const s=this.soundBuffers.get(e);if(!s)return void console.warn(`Sound not loaded: ${e}`);const n=this.audioContext.createBufferSource();n.buffer=s,n.loop=i;const r=this.audioContext.createGain();r.gain.value=t,n.connect(r),r.connect(this.audioContext.destination),this.activeSources.has(e)||this.activeSources.set(e,new Set),this.activeSources.get(e).add(n),n.onended=()=>{const t=this.activeSources.get(e);t&&t.delete(n)},n.start()}stopSound(e){const t=this.activeSources.get(e);t&&(t.forEach((e=>{try{e.stop()}catch(e){}})),t.clear())}stopAllSounds(){this.activeSources.forEach(((e,t)=>{e.forEach((e=>{try{e.stop()}catch(e){}})),e.clear()}))}}class I extends T{world;type;image=null;constructor(e,t,i,s){let n="",r=0;"aid_kit"===i?(n=g.AID_KIT,r=32):"goggles"===i&&(n=g.GOGGLES,r=32),super(t,r,r,s),this.world=e,this.type=i,v(n).then((e=>{this.image=e})),S.getInstance().loadSound(m.BONUS_PICKUP)}draw(e){if(!this.image||!this.world.player)return;const t=this.world.player;if(!(this.getPosition().distanceTo(t.getPosition())<=this.world.torchRadius+this.width||t.hasNightVision())||this.world.gameOver)return;const i=this.world.worldToScreenCoordinates(this.getPosition());e.save(),e.translate(i.x,i.y),e.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),e.restore()}}function E(e,t,i,s,n,r,a,o){const l=n,h=n+a,d=r,c=r+o;if(e<=l&&i<=l||e>=h&&i>=h||t<=d&&s<=d||t>=c&&s>=c)return!1;const u=(n,r,a,o)=>{const l=(e-i)*(r-o)-(t-s)*(n-a);if(0===l)return!1;const h=((e-n)*(r-o)-(t-r)*(n-a))/l,d=-((e-i)*(t-r)-(t-s)*(e-n))/l;return h>=0&&h<=1&&d>=0&&d<=1};return u(l,d,h,d)||u(h,d,h,c)||u(h,c,l,c)||u(l,c,l,d)}class B{x;y;constructor(e,t){this.x=e,this.y=t}add(e){return new B(this.x+e.x,this.y+e.y)}subtract(e){return new B(this.x-e.x,this.y-e.y)}multiply(e){return new B(this.x*e,this.y*e)}normalize(){const e=Math.sqrt(this.x*this.x+this.y*this.y);return 0===e?new B(0,0):new B(this.x/e,this.y/e)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}static fromAngle(e){return new B(-Math.sin(e),Math.cos(e))}getAngle(){return 270+180*Math.atan2(this.y,this.x)/Math.PI}}class N extends T{world;rotation;isEnemy;ownerId;_velocity;_speed;_active=!0;_damage;get active(){return this._active}get velocity(){return this._velocity}constructor(e,t,i,s,n,r){super(t,8,8,r),this.world=e,this.rotation=i,this.isEnemy=s,this.ownerId=n,this._damage=1,this._speed=s?240:420,this._velocity=B.fromAngle(i*Math.PI/180).multiply(this._speed)}update(e){if(!this._active)return;const t=this._velocity.x*e,i=this._velocity.y*e;this.moveBy(t,i)}draw(e){if(!this._active)return;const t=this.world.worldToScreenCoordinates(this.getPosition());e.save(),e.translate(t.x,t.y),e.rotate(this.rotation*Math.PI/180),e.fillStyle=this.isEnemy?"#FF0000":"#00FFFF",e.beginPath(),e.arc(0,0,this.width/2,0,2*Math.PI),e.fill(),e.restore()}}class L extends T{world;_wall;speed=120;image=null;bloodImage=null;direction=1;nightVisionDetectionRadius=100;dead=!1;deadTimer=0;shootDelay=0;reward=10;_lives=1;_bullets=[];_rotation=0;get lives(){return this._lives}get wall(){return this._wall}constructor(e,t,s,n){const r=24,a=Math.random()<.5?1:-1;let o,l;if("vertical"===t.orientation){o=t.x-a*(t.width/2+12),l=t.y+Math.random()*t.height;let e=r,i=1;for(;l>=t.y+r&&l<t.y+t.height&&s.some((e=>e.checkCollision(o-12,l-12,r,r)));)l+=i*e,e+=r,i*=-1}else{o=t.x+Math.random()*t.width,l=t.y-a*(t.height/2+12);let e=r,i=1;for(;o>=t.x+r&&o<t.x+t.width&&s.some((e=>e.checkCollision(o-12,l-12,r,r)));)o+=i*e,e+=r,i*=-1}super(new i(o,l),r,r,n),this.world=e,this._wall=t;const h=S.getInstance();h.loadSound(m.BULLET),h.loadSound(m.ENEMY_HURT),v(g.ENEMY).then((e=>{this.image=e})),v(g.BLOOD).then((e=>{this.bloodImage=e}))}canSeePlayer(){const e=this.world.player;if(this.world.gameOver||!e)return!1;const t=e.x-this.x,i=e.y-this.y,s=Math.sqrt(t*t+i*i);if(e.hasNightVision()&&s>this.nightVisionDetectionRadius)return!1;if(s>this.world.torchRadius)return!1;for(const t of this.world.walls){const i=t.getLeftTopCorner();if(E(this.x,this.y,e.x,e.y,i.x,i.y,t.width,t.height))return!1}return!0}get rotation(){return this._rotation}getGunPoint(){return this.getPosition().movedByPointCoordinates(u.inverted()).moveByPointCoordinates(f).rotateAroundPointCoordinates(this.getPosition(),this.rotation)}shoot(e){if(this.shootDelay>0)return void(this.shootDelay=Math.max(0,this.shootDelay-e));const t=this.getGunPoint(),i=new N(this.world,t,this.rotation,!0);this._bullets.push(i);const s=this.world.player;if(!s)return;const n=Math.sqrt((this.x-s.x)**2+(this.y-s.y)**2),r=Math.max(1-.5*n/200,0);S.getInstance().playSound(m.BULLET,r),this.shootDelay=1}draw(e,t){this._bullets.forEach((i=>{i.draw(e,t)}));const s=this.world.player;if(!this.image||!s)return;let n=!1;if(this.world.gameOver)n=!1;else if(s.isAlive()&&s.hasNightVision())n=!0;else{const e=[s,...this.world.otherPlayers.filter((e=>e.isAlive()&&!e.hasNightVision))];for(const t of e){const e=this.getPosition().distanceTo(t.getTorchPoint());n=n||e<=this.world.torchRadius+this.width}}const r=this.world.worldToScreenCoordinates(this.getPosition());e.save(),e.translate(r.x,r.y);const a=this.dead?32:64,l=this.dead?new i(-a/2,-a/2):u.inverted();if(e.rotate(this.rotation*Math.PI/180),this.dead&&n&&this.bloodImage&&e.drawImage(this.bloodImage,-this.width/2,-this.height/2,this.width,this.height),!this.dead&&n&&this.image&&e.drawImage(this.image,l.x,l.y,a,a),e.restore(),this.world.debug){if(t.save(),t.translate(r.x,r.y),t.strokeStyle="#00ff00",t.strokeRect(-this.width/2,-this.height/2,this.width,this.height),!this.dead){t.rotate(this.rotation*Math.PI/180),t.fillStyle="magenta";const e=l.movedByPointCoordinates(f);t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill(),t.rotate(-this.rotation*Math.PI/180)}t.fillStyle="white",t.font=`12px ${o}`,t.textAlign="left",t.fillText(`Wall #${this._wall.id}`,-20,24),t.fillText(`Position: ${this.getPosition()}`,-20,36),t.restore()}}isAlive(){return!this.dead}isInvulnerable(){return!1}applyFromGameState(e){this._point.setTo(e.position.x,e.position.y),this._rotation=e.rotation,this._lives=e.lives,this.dead=e.isDead}}class P extends T{world;_nightVisionTimer=0;_image=null;_imageDead=null;_rotation=0;_bullets=[];_bulletsLeft=6;_kills=0;_money=0;_invulnerableTimer=0;_debugData={};_lives=0;get money(){return this._money}get kills(){return this._kills}get bulletsLeft(){return this._bulletsLeft}get rotation(){return this._rotation}get nightVisionTimer(){return this._nightVisionTimer}static createFromSessionPlayer(e,t){const s=new P(e,new i(t.position.x,t.position.y),t.position.rotation,t.player_id);return s._lives=t.lives,s._kills=t.kills,s._money=t.money,s}constructor(e,t,i,s=""){super(t,24,24,s),this.world=e,this._rotation=i;const n=S.getInstance();n.loadSound(m.BULLET),n.loadSound(m.PLAYER_HURT),n.loadSound(m.PLAYER_BULLET_RECHARGE),v(g.PLAYER).then((e=>{this._image=e})),v(g.BLOOD).then((e=>{this._imageDead=e}))}getGunPoint(){return this.getPosition().movedByPointCoordinates(h.inverted()).moveByPointCoordinates(d).rotateAroundPointCoordinates(this.getPosition(),this._rotation)}getTorchPoint(){return this.getPosition().movedByPointCoordinates(h.inverted()).moveByPointCoordinates(c).rotateAroundPointCoordinates(this.getPosition(),this._rotation)}takeDamage(e){this._lives-=e,S.getInstance().playSound(this._lives>0?m.PLAYER_HURT:m.PLAYER_DEAD)}hasNightVision(){return this._nightVisionTimer>0}isNightVisionFading(){return this._nightVisionTimer<2&&this._nightVisionTimer%.2<.1}update(e){this._invulnerableTimer>0&&(this._invulnerableTimer=Math.max(0,this._invulnerableTimer-e)),this._nightVisionTimer>0&&(this._nightVisionTimer=Math.max(0,this._nightVisionTimer-e))}draw(e,t){if(this._bullets.forEach((i=>{i.draw(e,t)})),!this._image||!this._imageDead)return;const i=this.world.worldToScreenCoordinates(this.getPosition());e.save();const s=5*this._invulnerableTimer/1,n=s-Math.floor(s)<.5,r=h.inverted();if(e.translate(i.x,i.y),(this._invulnerableTimer<=0||n)&&!this.world.gameOver){this.isAlive()?this._image:this._imageDead;const t=this.isAlive()?64:32;e.rotate(this._rotation*Math.PI/180),e.drawImage(this.isAlive()?this._image:this._imageDead,r.x,r.y,t,t),e.rotate(-this._rotation*Math.PI/180)}if(e.restore(),this.world.debug){t.strokeStyle="red",t.strokeRect(-this.width/2+i.x,-this.height/2+i.y,this.width,this.height),t.fillStyle="magenta",t.beginPath(),t.arc(i.x,i.y,2,0,2*Math.PI),t.fill(),t.fillStyle="magenta";const e=this.world.worldToScreenCoordinates(this.getGunPoint());t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill(),t.fillStyle="cyan";const s=this.world.worldToScreenCoordinates(this.getTorchPoint());t.beginPath(),t.arc(s.x,s.y,2,0,2*Math.PI),t.fill()}}drawUI(e){this.world.debug&&(e.fillStyle="white",e.font=`12px ${o}`,e.textAlign="left",e.fillText(`Collision hits: ${this._debugData.collisionHits}`,10,e.canvas.height-38),e.fillText(`Player position: ${this.getPosition()}`,10,e.canvas.height-24),e.fillText(`Rotation: ${this._rotation}`,10,e.canvas.height-10))}isAlive(){return this._lives>0}die(){}get lives(){return this._lives}recordKill(e){this._kills++,this._money+=e}isInvulnerable(){return this._invulnerableTimer>0}applyFromGameState(e){e.position&&(this.getPosition().setTo(e.position.x,e.position.y),this._rotation=e.rotation),this._lives>e.lives?this.takeDamage(this._lives-e.lives):this._lives<e.lives&&(this._lives=e.lives),this.isAlive()||setTimeout((()=>{this.world.endGame()}),1e3),this._money=e.money,this._kills=e.kills,this._bulletsLeft<e.bulletsLeft&&S.getInstance().playSound(m.PLAYER_BULLET_RECHARGE,.5),this._bulletsLeft=e.bulletsLeft,this._invulnerableTimer=e.invulnerableTimer,this._nightVisionTimer=e.nightVisionTimer}}class R extends T{world;_orientation;image=null;constructor(e,t,i,s,n,r){super(t,i,s,r),this.world=e,this._orientation=n,v(g.WALL).then((e=>{this.image=e}))}get orientation(){return this._orientation}draw(e,t){if(!this.image)return;const i=this.world.worldToScreenCoordinates(this.getLeftTopCorner());t.save(),t.translate(i.x,i.y),e.save(),e.translate(i.x,i.y);let[s,n]=[this._width,this._height];if("vertical"===this._orientation&&([s,n]=[this._height,this._width]),"vertical"===this._orientation&&(e.rotate(Math.PI/2),e.translate(0,-this.width),t.rotate(Math.PI/2),t.translate(0,-this.width)),e.drawImage(this.image,0,0,s,n),this.world.debug&&(t.strokeStyle="red",t.strokeRect(0,0,s,n),t.fillStyle="white",t.font=`12px ${o}`,t.fillText(`#${this.id} ${this.getPosition()}`,2,12),t.fillText(`Width: ${this.width}, Height: ${this.height}`,2,24)),e.restore(),t.restore(),this.world.debug){const e=this.world.worldToScreenCoordinates(this.getPosition());t.fillStyle="magenta",t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill()}}getCollisionRect(){const{x:e,y:t}=this.getLeftTopCorner();return{left:e,top:t,width:this._width,height:this.height}}getLeftTopCorner(){let e=0,t=0;return"vertical"==this.orientation?e=this._width/2:t=this.height/2,this.getPosition().movedBy(-e,-t)}}class x{static instance;userData=null;authUrl=null;performingRequest=!1;_token=null;urls={login:"/auth/google/url",user:"/auth/user"};constructor(){}static getInstance(){return x.instance||(x.instance=new x),x.instance}async get(e,t={}){this.performingRequest=!0;try{const i=await fetch(n+e,{method:"GET",...t,headers:{...t.headers,Authorization:`Bearer ${this.getToken()}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);return i.json()}catch(e){throw console.error("Request failed: ",e),e}finally{this.performingRequest=!1}}initToken(){let e=new URLSearchParams(window.location.search).get("token");e?(localStorage.setItem("token",e),history.pushState({},"",window.location.pathname)):e=localStorage.getItem("token"),this._token=e}getToken(){return this._token}async getAuthUrl(){const e=await this.get(this.urls.login);return this.authUrl=e.url,this.authUrl}async checkAuthStatus(){const e=await this.get(this.urls.user);return this.userData=e,e}isPerformingRequest(){return this.performingRequest}getUserData(){return this.userData}openAuthPage(){this.authUrl&&(window.location.href=this.authUrl)}}class D{static getUrl(e,t){const i=new URL(n+e);return t&&Object.entries(t).forEach((([e,t])=>{i.searchParams.append(e,t)})),i.toString()}static async request(e,t={}){const{params:i,...s}=t,n=this.getUrl(e,i),r=x.getInstance(),a=new Headers(t.headers||{});a.set("Content-Type","application/json");const o=r.getToken();o&&a.set("Authorization",`Bearer ${o}`);const l=await fetch(n,{...s,headers:a});if(!l.ok){const e=new Error;throw e.message=await l.text(),e.code=l.status,e}return l.json()}static async get(e,t={}){return this.request(e,{...t,method:"GET"})}static async post(e,t,i={}){return this.request(e,{...i,method:"POST",body:t?JSON.stringify(t):void 0})}static async patch(e,t,i={}){return this.request(e,{...i,method:"PATCH",body:JSON.stringify(t)})}static async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}}var O,A;function U(e,t,i){let s,n,r=i;for(let i of e.fields){let e=i.localName;if(i.oneof){const a=r[i.oneof];if(null==(null==a?void 0:a.oneofKind))continue;if(s=a[e],n=t[i.oneof],n.oneofKind=a.oneofKind,null==s){delete n[e];continue}}else if(s=r[e],n=t,null==s)continue;switch(i.repeat&&(n[e].length=s.length),i.kind){case"scalar":case"enum":if(i.repeat)for(let t=0;t<s.length;t++)n[e][t]=s[t];else n[e]=s;break;case"message":let t=i.T();if(i.repeat)for(let i=0;i<s.length;i++)n[e][i]=t.create(s[i]);else void 0===n[e]?n[e]=t.create(s):t.mergePartial(n[e],s);break;case"map":switch(i.V.kind){case"scalar":case"enum":Object.assign(n[e],s);break;case"message":let t=i.V.T();for(let i of Object.keys(s))n[e][i]=t.create(s[i])}}}}!function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(i,s,n,r,a)=>{(t(s)?s[e.symbol]:s[e.symbol]=[]).push({no:n,wireType:r,data:a})},e.onWrite=(t,i,s)=>{for(let{no:t,wireType:n,data:r}of e.list(i))s.tag(t,n).raw(r)},e.list=(i,s)=>{if(t(i)){let t=i[e.symbol];return s?t.filter((e=>e.no==s)):t}return[]},e.last=(t,i)=>e.list(t,i).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(O||(O={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(A||(A={}));const M=Symbol.for("protobuf-ts/message-type");function C(e){let t=!1;const i=[];for(let s=0;s<e.length;s++){let n=e.charAt(s);"_"==n?t=!0:/\d/.test(n)?(i.push(n),t=!0):t?(i.push(n.toUpperCase()),t=!1):0==s?i.push(n.toLowerCase()):i.push(n)}return i.join("")}var j,F,V;function $(e){var t,i,s,n;return e.localName=null!==(t=e.localName)&&void 0!==t?t:C(e.name),e.jsonName=null!==(i=e.jsonName)&&void 0!==i?i:C(e.name),e.repeat=null!==(s=e.repeat)&&void 0!==s?s:V.NO,e.opt=null!==(n=e.opt)&&void 0!==n?n:!e.repeat&&!e.oneof&&"message"==e.kind,e}function W(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(j||(j={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(F||(F={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(V||(V={}));class G{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],i=[];for(let s of this.fields)if(s.oneof)i.includes(s.oneof)||(i.push(s.oneof),e.push(s.oneof),t.push(s.oneof));else switch(t.push(s.localName),s.kind){case"scalar":case"enum":s.opt&&!s.repeat||e.push(s.localName);break;case"message":s.repeat&&e.push(s.localName);break;case"map":e.push(s.localName)}this.data={req:e,known:t,oneofs:Object.values(i)}}is(e,t,i=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let s=Object.keys(e),n=this.data;if(s.length<n.req.length||n.req.some((e=>!s.includes(e))))return!1;if(!i&&s.some((e=>!n.known.includes(e))))return!1;if(t<1)return!0;for(const s of n.oneofs){const n=e[s];if(!W(n))return!1;if(void 0===n.oneofKind)continue;const r=this.fields.find((e=>e.localName===n.oneofKind));if(!r)return!1;if(!this.field(n[n.oneofKind],r,i,t))return!1}for(const s of this.fields)if(void 0===s.oneof&&!this.field(e[s.localName],s,i,t))return!1;return!0}field(e,t,i,s){let n=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:n?this.scalars(e,t.T,s,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:n?this.scalars(e,j.INT32,s):this.scalar(e,j.INT32);case"message":return void 0===e||(n?this.messages(e,t.T(),i,s):this.message(e,t.T(),i,s));case"map":if("object"!=typeof e||null===e)return!1;if(s<2)return!0;if(!this.mapKeys(e,t.K,s))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,s,t.V.L);case"enum":return this.scalars(Object.values(e),j.INT32,s);case"message":return this.messages(Object.values(e),t.V.T(),i,s)}}return!0}message(e,t,i,s){return i?t.isAssignable(e,s):t.is(e,s)}messages(e,t,i,s){if(!Array.isArray(e))return!1;if(s<2)return!0;if(i){for(let i=0;i<e.length&&i<s;i++)if(!t.isAssignable(e[i],s-1))return!1}else for(let i=0;i<e.length&&i<s;i++)if(!t.is(e[i],s-1))return!1;return!0}scalar(e,t,i){let s=typeof e;switch(t){case j.UINT64:case j.FIXED64:case j.INT64:case j.SFIXED64:case j.SINT64:switch(i){case F.BIGINT:return"bigint"==s;case F.NUMBER:return"number"==s&&!isNaN(e);default:return"string"==s}case j.BOOL:return"boolean"==s;case j.STRING:return"string"==s;case j.BYTES:return e instanceof Uint8Array;case j.DOUBLE:case j.FLOAT:return"number"==s&&!isNaN(e);default:return"number"==s&&Number.isInteger(e)}}scalars(e,t,i,s){if(!Array.isArray(e))return!1;if(i<2)return!0;if(Array.isArray(e))for(let n=0;n<e.length&&n<i;n++)if(!this.scalar(e[n],t,s))return!1;return!0}mapKeys(e,t,i){let s=Object.keys(e);switch(t){case j.INT32:case j.FIXED32:case j.SFIXED32:case j.SINT32:case j.UINT32:return this.scalars(s.slice(0,i).map((e=>parseInt(e))),t,i);case j.BOOL:return this.scalars(s.slice(0,i).map((e=>"true"==e||"false"!=e&&e)),t,i);default:return this.scalars(s,t,i,F.STRING)}}}function K(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}let H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Y=[];for(let e=0;e<H.length;e++)Y[H[e].charCodeAt(0)]=e;function J(){let e=0,t=0;for(let i=0;i<28;i+=7){let s=this.buf[this.pos++];if(e|=(127&s)<<i,!(128&s))return this.assertBounds(),[e,t]}let i=this.buf[this.pos++];if(e|=(15&i)<<28,t=(112&i)>>4,!(128&i))return this.assertBounds(),[e,t];for(let i=3;i<=31;i+=7){let s=this.buf[this.pos++];if(t|=(127&s)<<i,!(128&s))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function X(e,t,i){for(let s=0;s<28;s+=7){const n=e>>>s,r=!(n>>>7==0&&0==t),a=255&(r?128|n:n);if(i.push(a),!r)return}const s=e>>>28&15|(7&t)<<4,n=!!(t>>3);if(i.push(255&(n?128|s:s)),n){for(let e=3;e<31;e+=7){const s=t>>>e,n=!(s>>>7==0),r=255&(n?128|s:s);if(i.push(r),!n)return}i.push(t>>>31&1)}}Y["-".charCodeAt(0)]=H.indexOf("+"),Y["_".charCodeAt(0)]=H.indexOf("/");const q=4294967296;function Z(e){let t="-"==e[0];t&&(e=e.slice(1));const i=1e6;let s=0,n=0;function r(t,r){const a=Number(e.slice(t,r));n*=i,s=s*i+a,s>=q&&(n+=s/q|0,s%=q)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),[t,s,n]}function z(e,t){if(t>>>0<=2097151)return""+(q*t+(e>>>0));let i=(e>>>24|t<<8)>>>0&16777215,s=t>>16&65535,n=(16777215&e)+6777216*i+6710656*s,r=i+8147497*s,a=2*s,o=1e7;function l(e,t){let i=e?String(e):"";return t?"0000000".slice(i.length)+i:i}return n>=o&&(r+=Math.floor(n/o),n%=o),r>=o&&(a+=Math.floor(r/o),r%=o),l(a,0)+l(r,a)+l(n,1)}function Q(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let i=0;i<9;i++)t.push(127&e|128),e>>=7;t.push(1)}}function ee(){let e=this.buf[this.pos++],t=127&e;if(!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,!(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,!(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;128&e&&t<10;t++)e=this.buf[this.pos++];if(128&e)throw new Error("invalid varint");return this.assertBounds(),t>>>0}let te;function ie(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;te=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const se=/^-?[0-9]+$/,ne=4294967296,re=2147483648;class ae{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*ne+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class oe extends ae{static from(e){if(te)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=te.C(e);case"number":if(0===e)return this.ZERO;e=te.C(e);case"bigint":if(!e)return this.ZERO;if(e<te.UMIN)throw new Error("signed value for ulong");if(e>te.UMAX)throw new Error("ulong too large");return te.V.setBigUint64(0,e,!0),new oe(te.V.getInt32(0,!0),te.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!se.test(e))throw new Error("string is no integer");let[t,i,s]=Z(e);if(t)throw new Error("signed value for ulong");return new oe(i,s);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new oe(e,e/ne)}throw new Error("unknown value "+typeof e)}toString(){return te?this.toBigInt().toString():z(this.lo,this.hi)}toBigInt(){return ie(te),te.V.setInt32(0,this.lo,!0),te.V.setInt32(4,this.hi,!0),te.V.getBigUint64(0,!0)}}oe.ZERO=new oe(0,0);class le extends ae{static from(e){if(te)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=te.C(e);case"number":if(0===e)return this.ZERO;e=te.C(e);case"bigint":if(!e)return this.ZERO;if(e<te.MIN)throw new Error("signed long too small");if(e>te.MAX)throw new Error("signed long too large");return te.V.setBigInt64(0,e,!0),new le(te.V.getInt32(0,!0),te.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!se.test(e))throw new Error("string is no integer");let[t,i,s]=Z(e);if(t){if(s>re||s==re&&0!=i)throw new Error("signed long too small")}else if(s>=re)throw new Error("signed long too large");let n=new le(i,s);return t?n.negate():n;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new le(e,e/ne):new le(-e,-e/ne).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return!!(this.hi&re)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new le(t,e)}toString(){if(te)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+z(e.lo,e.hi)}return z(this.lo,this.hi)}toBigInt(){return ie(te),te.V.setInt32(0,this.lo,!0),te.V.setInt32(4,this.hi,!0),te.V.getBigInt64(0,!0)}}function he(e,t){if(!e)throw new Error(t)}function de(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function ce(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function ue(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}function fe(e,t){switch(t){case F.BIGINT:return e.toBigInt();case F.NUMBER:return e.toNumber();default:return e.toString()}}le.ZERO=new le(0,0);class ge{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,i){if(!e){let e=K(i);throw"number"!=e&&"boolean"!=e||(e=i.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,i){this.prepare();const s=[];for(const[r,a]of Object.entries(e)){const e=this.fMap[r];if(!e){if(!i.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const o=e.localName;let l;if(e.oneof){if(null===a&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(s.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);s.push(e.oneof),l=t[e.oneof]={oneofKind:o}}else l=t;if("map"==e.kind){if(null===a)continue;this.assert(null!==(n=a)&&"object"==typeof n&&!Array.isArray(n),e.name,a);const t=l[o];for(const[s,n]of Object.entries(a)){let r;switch(this.assert(null!==n,e.name+" map value",null),e.V.kind){case"message":r=e.V.T().internalJsonRead(n,i);break;case"enum":if(r=this.enum(e.V.T(),n,e.name,i.ignoreUnknownFields),!1===r)continue;break;case"scalar":r=this.scalar(n,e.V.T,e.V.L,e.name)}this.assert(void 0!==r,e.name+" map value",n);let a=s;e.K==j.BOOL&&(a="true"==a||"false"!=a&&a),a=this.scalar(a,e.K,F.STRING,e.name).toString(),t[a]=r}}else if(e.repeat){if(null===a)continue;this.assert(Array.isArray(a),e.name,a);const t=l[o];for(const s of a){let n;switch(this.assert(null!==s,e.name,null),e.kind){case"message":n=e.T().internalJsonRead(s,i);break;case"enum":if(n=this.enum(e.T(),s,e.name,i.ignoreUnknownFields),!1===n)continue;break;case"scalar":n=this.scalar(s,e.T,e.L,e.name)}this.assert(void 0!==n,e.name,a),t.push(n)}}else switch(e.kind){case"message":if(null===a&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}l[o]=e.T().internalJsonRead(a,i,l[o]);break;case"enum":if(null===a)continue;let t=this.enum(e.T(),a,e.name,i.ignoreUnknownFields);if(!1===t)continue;l[o]=t;break;case"scalar":if(null===a)continue;l[o]=this.scalar(a,e.T,e.L,e.name)}}var n}enum(e,t,i,s){if("google.protobuf.NullValue"==e[0]&&he(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return he(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${i}, enum can only be integral number, got ${t}.`),t;case"string":let n=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(n=t.substring(e[2].length));let r=e[1][n];return(void 0!==r||!s)&&(he("number"==typeof r,`Unable to parse field ${this.info.typeName}#${i}, enum ${e[0]} has no value for "${t}".`),r)}he(!1,`Unable to parse field ${this.info.typeName}#${i}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,i,s){let n;try{switch(t){case j.DOUBLE:case j.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){n="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){n="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let s=Number(e);if(Number.isNaN(s)){n="not a number";break}if(!Number.isFinite(s)){n="too large or small";break}return t==j.FLOAT&&ue(s),s;case j.INT32:case j.FIXED32:case j.SFIXED32:case j.SINT32:case j.UINT32:if(null===e)return 0;let r;if("number"==typeof e?r=e:""===e?n="empty string":"string"==typeof e&&(e.trim().length!==e.length?n="extra whitespace":r=Number(e)),void 0===r)break;return t==j.UINT32?ce(r):de(r),r;case j.INT64:case j.SFIXED64:case j.SINT64:if(null===e)return fe(le.ZERO,i);if("number"!=typeof e&&"string"!=typeof e)break;return fe(le.from(e),i);case j.FIXED64:case j.UINT64:if(null===e)return fe(oe.ZERO,i);if("number"!=typeof e&&"string"!=typeof e)break;return fe(oe.from(e),i);case j.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case j.STRING:if(null===e)return"";if("string"!=typeof e){n="extra whitespace";break}try{encodeURIComponent(e)}catch(n){n="invalid UTF8";break}return e;case j.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let i,s=new Uint8Array(t),n=0,r=0,a=0;for(let t=0;t<e.length;t++){if(i=Y[e.charCodeAt(t)],void 0===i)switch(e[t]){case"=":r=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:a=i,r=1;break;case 1:s[n++]=a<<2|(48&i)>>4,a=i,r=2;break;case 2:s[n++]=(15&a)<<4|(60&i)>>2,a=i,r=3;break;case 3:s[n++]=(3&a)<<6|i,r=0}}if(1==r)throw Error("invalid base64 string.");return s.subarray(0,n)}(e)}}catch(e){n=e.message}this.assert(!1,s+(n?" - "+n:""),e)}}class me{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const i={},s=e;for(const e of this.fields){if(!e.oneof){let n=this.field(e,s[e.localName],t);void 0!==n&&(i[t.useProtoFieldName?e.name:e.jsonName]=n);continue}const n=s[e.oneof];if(n.oneofKind!==e.localName)continue;const r="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let a=this.field(e,n[e.localName],r);he(void 0!==a),i[t.useProtoFieldName?e.name:e.jsonName]=a}return i}field(e,t,i){let s;if("map"==e.kind){he("object"==typeof t&&null!==t);const n={};switch(e.V.kind){case"scalar":for(const[i,s]of Object.entries(t)){const t=this.scalar(e.V.T,s,e.name,!1,!0);he(void 0!==t),n[i.toString()]=t}break;case"message":const s=e.V.T();for(const[r,a]of Object.entries(t)){const t=this.message(s,a,e.name,i);he(void 0!==t),n[r.toString()]=t}break;case"enum":const r=e.V.T();for(const[s,a]of Object.entries(t)){he(void 0===a||"number"==typeof a);const t=this.enum(r,a,e.name,!1,!0,i.enumAsInteger);he(void 0!==t),n[s.toString()]=t}}(i.emitDefaultValues||Object.keys(n).length>0)&&(s=n)}else if(e.repeat){he(Array.isArray(t));const n=[];switch(e.kind){case"scalar":for(let i=0;i<t.length;i++){const s=this.scalar(e.T,t[i],e.name,e.opt,!0);he(void 0!==s),n.push(s)}break;case"enum":const s=e.T();for(let r=0;r<t.length;r++){he(void 0===t[r]||"number"==typeof t[r]);const a=this.enum(s,t[r],e.name,e.opt,!0,i.enumAsInteger);he(void 0!==a),n.push(a)}break;case"message":const r=e.T();for(let s=0;s<t.length;s++){const a=this.message(r,t[s],e.name,i);he(void 0!==a),n.push(a)}}(i.emitDefaultValues||n.length>0||i.emitDefaultValues)&&(s=n)}else switch(e.kind){case"scalar":s=this.scalar(e.T,t,e.name,e.opt,i.emitDefaultValues);break;case"enum":s=this.enum(e.T(),t,e.name,e.opt,i.emitDefaultValues,i.enumAsInteger);break;case"message":s=this.message(e.T(),t,e.name,i)}return s}enum(e,t,i,s,n,r){if("google.protobuf.NullValue"==e[0])return n||s?null:void 0;if(void 0!==t){if(0!==t||n||s)return he("number"==typeof t),he(Number.isInteger(t)),r||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else he(s)}message(e,t,i,s){return void 0===t?s.emitDefaultValues?null:void 0:e.internalJsonWrite(t,s)}scalar(e,t,i,s,n){if(void 0===t)return void he(s);const r=n||s;switch(e){case j.INT32:case j.SFIXED32:case j.SINT32:return 0===t?r?0:void 0:(de(t),t);case j.FIXED32:case j.UINT32:return 0===t?r?0:void 0:(ce(t),t);case j.FLOAT:ue(t);case j.DOUBLE:return 0===t?r?0:void 0:(he("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case j.STRING:return""===t?r?"":void 0:(he("string"==typeof t),t);case j.BOOL:return!1===t?!r&&void 0:(he("boolean"==typeof t),t);case j.UINT64:case j.FIXED64:he("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=oe.from(t);if(e.isZero()&&!r)return;return e.toString();case j.INT64:case j.SFIXED64:case j.SINT64:he("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let i=le.from(t);if(i.isZero()&&!r)return;return i.toString();case j.BYTES:return he(t instanceof Uint8Array),t.byteLength?function(e){let t,i="",s=0,n=0;for(let r=0;r<e.length;r++)switch(t=e[r],s){case 0:i+=H[t>>2],n=(3&t)<<4,s=1;break;case 1:i+=H[n|t>>4],n=(15&t)<<2,s=2;break;case 2:i+=H[n|t>>6],i+=H[63&t],s=0}return s&&(i+=H[n],i+="=",1==s&&(i+="=")),i}(t):r?"":void 0}}}function pe(e,t=F.STRING){switch(e){case j.BOOL:return!1;case j.UINT64:case j.FIXED64:return fe(oe.ZERO,t);case j.INT64:case j.SFIXED64:case j.SINT64:return fe(le.ZERO,t);case j.DOUBLE:case j.FLOAT:return 0;case j.BYTES:return new Uint8Array(0);case j.STRING:return"";default:return 0}}class ye{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map((e=>[e.no,e])))}}read(e,t,i,s){this.prepare();const n=void 0===s?e.len:e.pos+s;for(;e.pos<n;){const[s,n]=e.tag(),r=this.fieldNoToField.get(s);if(!r){let r=i.readUnknownField;if("throw"==r)throw new Error(`Unknown field ${s} (wire type ${n}) for ${this.info.typeName}`);let a=e.skip(n);!1!==r&&(!0===r?O.onRead:r)(this.info.typeName,t,s,n,a);continue}let a=t,o=r.repeat,l=r.localName;switch(r.oneof&&(a=a[r.oneof],a.oneofKind!==l&&(a=t[r.oneof]={oneofKind:l})),r.kind){case"scalar":case"enum":let t="enum"==r.kind?j.INT32:r.T,s="scalar"==r.kind?r.L:void 0;if(o){let i=a[l];if(n==A.LengthDelimited&&t!=j.STRING&&t!=j.BYTES){let n=e.uint32()+e.pos;for(;e.pos<n;)i.push(this.scalar(e,t,s))}else i.push(this.scalar(e,t,s))}else a[l]=this.scalar(e,t,s);break;case"message":if(o){let t=a[l],s=r.T().internalBinaryRead(e,e.uint32(),i);t.push(s)}else a[l]=r.T().internalBinaryRead(e,e.uint32(),i,a[l]);break;case"map":let[h,d]=this.mapEntry(r,e,i);a[l][h]=d}}}mapEntry(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[r,a]=t.tag();switch(r){case 1:s=e.K==j.BOOL?t.bool().toString():this.scalar(t,e.K,F.STRING);break;case 2:switch(e.V.kind){case"scalar":n=this.scalar(t,e.V.T,e.V.L);break;case"enum":n=t.int32();break;case"message":n=e.V.T().internalBinaryRead(t,t.uint32(),i)}break;default:throw new Error(`Unknown field ${r} (wire type ${a}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===s){let t=pe(e.K);s=e.K==j.BOOL?t.toString():t}if(void 0===n)switch(e.V.kind){case"scalar":n=pe(e.V.T,e.V.L);break;case"enum":n=0;break;case"message":n=e.V.T().create()}return[s,n]}scalar(e,t,i){switch(t){case j.INT32:return e.int32();case j.STRING:return e.string();case j.BOOL:return e.bool();case j.DOUBLE:return e.double();case j.FLOAT:return e.float();case j.INT64:return fe(e.int64(),i);case j.UINT64:return fe(e.uint64(),i);case j.FIXED64:return fe(e.fixed64(),i);case j.FIXED32:return e.fixed32();case j.BYTES:return e.bytes();case j.UINT32:return e.uint32();case j.SFIXED32:return e.sfixed32();case j.SFIXED64:return fe(e.sfixed64(),i);case j.SINT32:return e.sint32();case j.SINT64:return fe(e.sint64(),i)}}}class we{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort(((e,t)=>e.no-t.no))}}write(e,t,i){this.prepare();for(const s of this.fields){let n,r,a=s.repeat,o=s.localName;if(s.oneof){const t=e[s.oneof];if(t.oneofKind!==o)continue;n=t[o],r=!0}else n=e[o],r=!1;switch(s.kind){case"scalar":case"enum":let e="enum"==s.kind?j.INT32:s.T;if(a)if(he(Array.isArray(n)),a==V.PACKED)this.packed(t,e,s.no,n);else for(const i of n)this.scalar(t,e,s.no,i,!0);else void 0===n?he(s.opt):this.scalar(t,e,s.no,n,r||s.opt);break;case"message":if(a){he(Array.isArray(n));for(const e of n)this.message(t,i,s.T(),s.no,e)}else this.message(t,i,s.T(),s.no,n);break;case"map":he("object"==typeof n&&null!==n);for(const[e,r]of Object.entries(n))this.mapEntry(t,i,s,e,r)}}let s=i.writeUnknownFields;!1!==s&&(!0===s?O.onWrite:s)(this.info.typeName,e,t)}mapEntry(e,t,i,s,n){e.tag(i.no,A.LengthDelimited),e.fork();let r=s;switch(i.K){case j.INT32:case j.FIXED32:case j.UINT32:case j.SFIXED32:case j.SINT32:r=Number.parseInt(s);break;case j.BOOL:he("true"==s||"false"==s),r="true"==s}switch(this.scalar(e,i.K,1,r,!0),i.V.kind){case"scalar":this.scalar(e,i.V.T,2,n,!0);break;case"enum":this.scalar(e,j.INT32,2,n,!0);break;case"message":this.message(e,t,i.V.T(),2,n)}e.join()}message(e,t,i,s,n){void 0!==n&&(i.internalBinaryWrite(n,e.tag(s,A.LengthDelimited).fork(),t),e.join())}scalar(e,t,i,s,n){let[r,a,o]=this.scalarInfo(t,s);o&&!n||(e.tag(i,r),e[a](s))}packed(e,t,i,s){if(!s.length)return;he(t!==j.BYTES&&t!==j.STRING),e.tag(i,A.LengthDelimited),e.fork();let[,n]=this.scalarInfo(t);for(let t=0;t<s.length;t++)e[n](s[t]);e.join()}scalarInfo(e,t){let i,s=A.Varint,n=void 0===t,r=0===t;switch(e){case j.INT32:i="int32";break;case j.STRING:r=n||!t.length,s=A.LengthDelimited,i="string";break;case j.BOOL:r=!1===t,i="bool";break;case j.UINT32:i="uint32";break;case j.DOUBLE:s=A.Bit64,i="double";break;case j.FLOAT:s=A.Bit32,i="float";break;case j.INT64:r=n||le.from(t).isZero(),i="int64";break;case j.UINT64:r=n||oe.from(t).isZero(),i="uint64";break;case j.FIXED64:r=n||oe.from(t).isZero(),s=A.Bit64,i="fixed64";break;case j.BYTES:r=n||!t.byteLength,s=A.LengthDelimited,i="bytes";break;case j.FIXED32:s=A.Bit32,i="fixed32";break;case j.SFIXED32:s=A.Bit32,i="sfixed32";break;case j.SFIXED64:r=n||le.from(t).isZero(),s=A.Bit64,i="sfixed64";break;case j.SINT32:i="sint32";break;case j.SINT64:r=n||le.from(t).isZero(),i="sint64"}return[s,i,n||r]}}const be={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},ke={ignoreUnknownFields:!1},_e=Object.values;function Te(e,t,i){if(t===i)return!0;if(e!==j.BYTES)return!1;let s=t,n=i;if(s.length!==n.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!=n[e])return!1;return!0}function ve(e,t,i){if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(!Te(e,t[s],i[s]))return!1;return!0}function Se(e,t,i){if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(!e.equals(t[s],i[s]))return!1;return!0}const Ie={writeUnknownFields:!0,writerFactory:()=>new Ee};class Ee{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),i=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],i),i+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ce(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return de(e),Q(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){ue(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){ce(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){de(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return de(e),Q(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=le.from(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),i=new DataView(t.buffer),s=oe.from(e);return i.setInt32(0,s.lo,!0),i.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=le.from(e);return X(t.lo,t.hi,this.buf),this}sint64(e){let t=le.from(e),i=t.hi>>31;return X(t.lo<<1^i,(t.hi<<1|t.lo>>>31)^i,this.buf),this}uint64(e){let t=oe.from(e);return X(t.lo,t.hi,this.buf),this}}const Be={readUnknownField:!0,readerFactory:e=>new Ne(e)};class Ne{constructor(e,t){this.varint64=J,this.uint32=ee,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,i=7&e;if(t<=0||i<0||i>5)throw new Error("illegal tag: field no "+t+" wire type "+i);return[t,i]}skip(e){let t=this.pos;switch(e){case A.Varint:for(;128&this.buf[this.pos++];);break;case A.Bit64:this.pos+=4;case A.Bit32:this.pos+=4;break;case A.LengthDelimited:let t=this.uint32();this.pos+=t;break;case A.StartGroup:let i;for(;(i=this.tag()[1])!==A.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new le(...this.varint64())}uint64(){return new oe(...this.varint64())}sint64(){let[e,t]=this.varint64(),i=-(1&e);return e=(e>>>1|(1&t)<<31)^i,t=t>>>1^i,new le(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new oe(this.sfixed32(),this.sfixed32())}sfixed64(){return new le(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}const Le=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({})),Pe=Le[M]={};class Re{constructor(e,t,i){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map($),this.options=null!=i?i:{},Pe.value=this,this.messagePrototype=Object.create(null,Le),this.refTypeCheck=new G(this),this.refJsonReader=new ge(this),this.refJsonWriter=new me(this),this.refBinReader=new ye(this),this.refBinWriter=new we(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},M,{value:e});for(let i of e.fields){let e=i.localName;if(!i.opt)if(i.oneof)t[i.oneof]={oneofKind:void 0};else if(i.repeat)t[e]=[];else switch(i.kind){case"scalar":t[e]=pe(i.T,i.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&U(this,t,e),t}clone(e){let t=this.create();return U(this,t,e),t}equals(e,t){return function(e,t,i){if(t===i)return!0;if(!t||!i)return!1;for(let s of e.fields){let e=s.localName,n=s.oneof?t[s.oneof][e]:t[e],r=s.oneof?i[s.oneof][e]:i[e];switch(s.kind){case"enum":case"scalar":let e="enum"==s.kind?j.INT32:s.T;if(!(s.repeat?ve(e,n,r):Te(e,n,r)))return!1;break;case"map":if(!("message"==s.V.kind?Se(s.V.T(),_e(n),_e(r)):ve("enum"==s.V.kind?j.INT32:s.V.T,_e(n),_e(r))))return!1;break;case"message":let t=s.T();if(!(s.repeat?Se(t,n,r):t.equals(n,r)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){U(this,e,t)}fromBinary(e,t){let i=function(e){return e?Object.assign(Object.assign({},Be),e):Be}(t);return this.internalBinaryRead(i.readerFactory(e),e.byteLength,i)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},ke),e):ke}(t))}fromJsonString(e,t){let i=JSON.parse(e);return this.fromJson(i,t)}toJson(e,t){return this.internalJsonWrite(e,function(e){return e?Object.assign(Object.assign({},be),e):be}(t))}toJsonString(e,t){var i;let s=this.toJson(e,t);return JSON.stringify(s,null,null!==(i=null==t?void 0:t.prettySpaces)&&void 0!==i?i:0)}toBinary(e,t){let i=function(e){return e?Object.assign(Object.assign({},Ie),e):Ie}(t);return this.internalBinaryWrite(e,i.writerFactory(),i).finish()}internalJsonRead(e,t,i){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let s=null!=i?i:this.create();return this.refJsonReader.read(e,s,t),s}throw new Error(`Unable to parse message ${this.typeName} from JSON ${K(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,i){return this.refBinWriter.write(e,t,i),t}internalBinaryRead(e,t,i,s){let n=null!=s?s:this.create();return this.refBinReader.read(e,n,i,t),n}}var xe;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.INPUT=2]="INPUT",e[e.GAME_STATE=5]="GAME_STATE",e[e.GAME_STATE_DELTA=11]="GAME_STATE_DELTA",e[e.PLAYER_JOIN=6]="PLAYER_JOIN",e[e.PLAYER_LEAVE=7]="PLAYER_LEAVE",e[e.PLAYER_RESPAWN=8]="PLAYER_RESPAWN",e[e.ERROR=10]="ERROR"}(xe||(xe={}));const De=new class extends Re{constructor(){super("protocol.Vector2",[{no:1,name:"x",kind:"scalar",T:1},{no:2,name:"y",kind:"scalar",T:1}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.x=0,t.y=0,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.x=e.double();break;case 2:n.y=e.double();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){0!==e.x&&t.tag(1,A.Bit64).double(e.x),0!==e.y&&t.tag(2,A.Bit64).double(e.y);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Oe=new class extends Re{constructor(){super("protocol.Player",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"position",kind:"message",T:()=>De},{no:4,name:"velocity",kind:"message",T:()=>De},{no:5,name:"lives",kind:"scalar",T:5},{no:13,name:"invulnerable_timer",kind:"scalar",T:1},{no:6,name:"score",kind:"scalar",T:5},{no:7,name:"money",kind:"scalar",T:5},{no:8,name:"kills",kind:"scalar",T:5},{no:9,name:"rotation",kind:"scalar",T:1},{no:10,name:"bullets_left",kind:"scalar",T:5},{no:11,name:"night_vision_timer",kind:"scalar",T:1},{no:12,name:"is_alive",kind:"scalar",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id="",t.username="",t.lives=0,t.invulnerableTimer=0,t.score=0,t.money=0,t.kills=0,t.rotation=0,t.bulletsLeft=0,t.nightVisionTimer=0,t.isAlive=!1,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.id=e.string();break;case 2:n.username=e.string();break;case 3:n.position=De.internalBinaryRead(e,e.uint32(),i,n.position);break;case 4:n.velocity=De.internalBinaryRead(e,e.uint32(),i,n.velocity);break;case 5:n.lives=e.int32();break;case 13:n.invulnerableTimer=e.double();break;case 6:n.score=e.int32();break;case 7:n.money=e.int32();break;case 8:n.kills=e.int32();break;case 9:n.rotation=e.double();break;case 10:n.bulletsLeft=e.int32();break;case 11:n.nightVisionTimer=e.double();break;case 12:n.isAlive=e.bool();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.id&&t.tag(1,A.LengthDelimited).string(e.id),""!==e.username&&t.tag(2,A.LengthDelimited).string(e.username),e.position&&De.internalBinaryWrite(e.position,t.tag(3,A.LengthDelimited).fork(),i).join(),e.velocity&&De.internalBinaryWrite(e.velocity,t.tag(4,A.LengthDelimited).fork(),i).join(),0!==e.lives&&t.tag(5,A.Varint).int32(e.lives),0!==e.score&&t.tag(6,A.Varint).int32(e.score),0!==e.money&&t.tag(7,A.Varint).int32(e.money),0!==e.kills&&t.tag(8,A.Varint).int32(e.kills),0!==e.rotation&&t.tag(9,A.Bit64).double(e.rotation),0!==e.bulletsLeft&&t.tag(10,A.Varint).int32(e.bulletsLeft),0!==e.nightVisionTimer&&t.tag(11,A.Bit64).double(e.nightVisionTimer),!1!==e.isAlive&&t.tag(12,A.Varint).bool(e.isAlive),0!==e.invulnerableTimer&&t.tag(13,A.Bit64).double(e.invulnerableTimer);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ae=new class extends Re{constructor(){super("protocol.Bullet",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"position",kind:"message",T:()=>De},{no:3,name:"velocity",kind:"message",T:()=>De},{no:4,name:"owner_id",kind:"scalar",T:9},{no:5,name:"damage",kind:"scalar",T:5},{no:6,name:"is_enemy",kind:"scalar",T:8},{no:7,name:"is_active",kind:"scalar",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id="",t.ownerId="",t.damage=0,t.isEnemy=!1,t.isActive=!1,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.id=e.string();break;case 2:n.position=De.internalBinaryRead(e,e.uint32(),i,n.position);break;case 3:n.velocity=De.internalBinaryRead(e,e.uint32(),i,n.velocity);break;case 4:n.ownerId=e.string();break;case 5:n.damage=e.int32();break;case 6:n.isEnemy=e.bool();break;case 7:n.isActive=e.bool();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.id&&t.tag(1,A.LengthDelimited).string(e.id),e.position&&De.internalBinaryWrite(e.position,t.tag(2,A.LengthDelimited).fork(),i).join(),e.velocity&&De.internalBinaryWrite(e.velocity,t.tag(3,A.LengthDelimited).fork(),i).join(),""!==e.ownerId&&t.tag(4,A.LengthDelimited).string(e.ownerId),0!==e.damage&&t.tag(5,A.Varint).int32(e.damage),!1!==e.isEnemy&&t.tag(6,A.Varint).bool(e.isEnemy),!1!==e.isActive&&t.tag(7,A.Varint).bool(e.isActive);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ue=new class extends Re{constructor(){super("protocol.Wall",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"position",kind:"message",T:()=>De},{no:3,name:"width",kind:"scalar",T:1},{no:4,name:"height",kind:"scalar",T:1},{no:5,name:"orientation",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id="",t.width=0,t.height=0,t.orientation="",void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.id=e.string();break;case 2:n.position=De.internalBinaryRead(e,e.uint32(),i,n.position);break;case 3:n.width=e.double();break;case 4:n.height=e.double();break;case 5:n.orientation=e.string();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.id&&t.tag(1,A.LengthDelimited).string(e.id),e.position&&De.internalBinaryWrite(e.position,t.tag(2,A.LengthDelimited).fork(),i).join(),0!==e.width&&t.tag(3,A.Bit64).double(e.width),0!==e.height&&t.tag(4,A.Bit64).double(e.height),""!==e.orientation&&t.tag(5,A.LengthDelimited).string(e.orientation);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Me=new class extends Re{constructor(){super("protocol.Enemy",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"position",kind:"message",T:()=>De},{no:3,name:"rotation",kind:"scalar",T:1},{no:4,name:"lives",kind:"scalar",T:5},{no:5,name:"wall_id",kind:"scalar",T:9},{no:6,name:"is_dead",kind:"scalar",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id="",t.rotation=0,t.lives=0,t.wallId="",t.isDead=!1,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.id=e.string();break;case 2:n.position=De.internalBinaryRead(e,e.uint32(),i,n.position);break;case 3:n.rotation=e.double();break;case 4:n.lives=e.int32();break;case 5:n.wallId=e.string();break;case 6:n.isDead=e.bool();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.id&&t.tag(1,A.LengthDelimited).string(e.id),e.position&&De.internalBinaryWrite(e.position,t.tag(2,A.LengthDelimited).fork(),i).join(),0!==e.rotation&&t.tag(3,A.Bit64).double(e.rotation),0!==e.lives&&t.tag(4,A.Varint).int32(e.lives),""!==e.wallId&&t.tag(5,A.LengthDelimited).string(e.wallId),!1!==e.isDead&&t.tag(6,A.Varint).bool(e.isDead);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ce=new class extends Re{constructor(){super("protocol.Bonus",[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"position",kind:"message",T:()=>De},{no:3,name:"type",kind:"scalar",T:9},{no:4,name:"picked_up_by",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id="",t.type="",t.pickedUpBy="",void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.id=e.string();break;case 2:n.position=De.internalBinaryRead(e,e.uint32(),i,n.position);break;case 3:n.type=e.string();break;case 4:n.pickedUpBy=e.string();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.id&&t.tag(1,A.LengthDelimited).string(e.id),e.position&&De.internalBinaryWrite(e.position,t.tag(2,A.LengthDelimited).fork(),i).join(),""!==e.type&&t.tag(3,A.LengthDelimited).string(e.type),""!==e.pickedUpBy&&t.tag(4,A.LengthDelimited).string(e.pickedUpBy);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},je=new class extends Re{constructor(){super("protocol.InputMessage",[{no:1,name:"forward",kind:"scalar",T:8},{no:2,name:"backward",kind:"scalar",T:8},{no:3,name:"left",kind:"scalar",T:8},{no:4,name:"right",kind:"scalar",T:8},{no:5,name:"shoot",kind:"scalar",T:8}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.forward=!1,t.backward=!1,t.left=!1,t.right=!1,t.shoot=!1,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.forward=e.bool();break;case 2:n.backward=e.bool();break;case 3:n.left=e.bool();break;case 4:n.right=e.bool();break;case 5:n.shoot=e.bool();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){!1!==e.forward&&t.tag(1,A.Varint).bool(e.forward),!1!==e.backward&&t.tag(2,A.Varint).bool(e.backward),!1!==e.left&&t.tag(3,A.Varint).bool(e.left),!1!==e.right&&t.tag(4,A.Varint).bool(e.right),!1!==e.shoot&&t.tag(5,A.Varint).bool(e.shoot);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Fe=new class extends Re{constructor(){super("protocol.GameStateMessage",[{no:1,name:"players",kind:"map",K:9,V:{kind:"message",T:()=>Oe}},{no:2,name:"bullets",kind:"map",K:9,V:{kind:"message",T:()=>Ae}},{no:3,name:"walls",kind:"map",K:9,V:{kind:"message",T:()=>Ue}},{no:4,name:"enemies",kind:"map",K:9,V:{kind:"message",T:()=>Me}},{no:5,name:"bonuses",kind:"map",K:9,V:{kind:"message",T:()=>Ce}},{no:6,name:"timestamp",kind:"scalar",T:3,L:0}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.players={},t.bullets={},t.walls={},t.enemies={},t.bonuses={},t.timestamp=0n,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:this.binaryReadMap1(n.players,e,i);break;case 2:this.binaryReadMap2(n.bullets,e,i);break;case 3:this.binaryReadMap3(n.walls,e,i);break;case 4:this.binaryReadMap4(n.enemies,e,i);break;case 5:this.binaryReadMap5(n.bonuses,e,i);break;case 6:n.timestamp=e.int64().toBigInt();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}binaryReadMap1(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Oe.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateMessage.players")}}e[s??""]=n??Oe.create()}binaryReadMap2(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ae.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateMessage.bullets")}}e[s??""]=n??Ae.create()}binaryReadMap3(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ue.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateMessage.walls")}}e[s??""]=n??Ue.create()}binaryReadMap4(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Me.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateMessage.enemies")}}e[s??""]=n??Me.create()}binaryReadMap5(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ce.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateMessage.bonuses")}}e[s??""]=n??Ce.create()}internalBinaryWrite(e,t,i){for(let s of globalThis.Object.keys(e.players))t.tag(1,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Oe.internalBinaryWrite(e.players[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.bullets))t.tag(2,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ae.internalBinaryWrite(e.bullets[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.walls))t.tag(3,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ue.internalBinaryWrite(e.walls[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.enemies))t.tag(4,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Me.internalBinaryWrite(e.enemies[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.bonuses))t.tag(5,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ce.internalBinaryWrite(e.bonuses[s],t,i),t.join().join();0n!==e.timestamp&&t.tag(6,A.Varint).int64(e.timestamp);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ve=new class extends Re{constructor(){super("protocol.GameStateDeltaMessage",[{no:1,name:"updated_players",kind:"map",K:9,V:{kind:"message",T:()=>Oe}},{no:2,name:"removed_players",kind:"scalar",repeat:2,T:9},{no:3,name:"updated_bullets",kind:"map",K:9,V:{kind:"message",T:()=>Ae}},{no:4,name:"removed_bullets",kind:"map",K:9,V:{kind:"message",T:()=>Ae}},{no:5,name:"updated_walls",kind:"map",K:9,V:{kind:"message",T:()=>Ue}},{no:6,name:"removed_walls",kind:"scalar",repeat:2,T:9},{no:7,name:"updated_enemies",kind:"map",K:9,V:{kind:"message",T:()=>Me}},{no:8,name:"removed_enemies",kind:"scalar",repeat:2,T:9},{no:9,name:"updated_bonuses",kind:"map",K:9,V:{kind:"message",T:()=>Ce}},{no:11,name:"timestamp",kind:"scalar",T:3,L:0}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.updatedPlayers={},t.removedPlayers=[],t.updatedBullets={},t.removedBullets={},t.updatedWalls={},t.removedWalls=[],t.updatedEnemies={},t.removedEnemies=[],t.updatedBonuses={},t.timestamp=0n,void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:this.binaryReadMap1(n.updatedPlayers,e,i);break;case 2:n.removedPlayers.push(e.string());break;case 3:this.binaryReadMap3(n.updatedBullets,e,i);break;case 4:this.binaryReadMap4(n.removedBullets,e,i);break;case 5:this.binaryReadMap5(n.updatedWalls,e,i);break;case 6:n.removedWalls.push(e.string());break;case 7:this.binaryReadMap7(n.updatedEnemies,e,i);break;case 8:n.removedEnemies.push(e.string());break;case 9:this.binaryReadMap9(n.updatedBonuses,e,i);break;case 11:n.timestamp=e.int64().toBigInt();break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}binaryReadMap1(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Oe.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.updated_players")}}e[s??""]=n??Oe.create()}binaryReadMap3(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ae.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.updated_bullets")}}e[s??""]=n??Ae.create()}binaryReadMap4(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ae.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.removed_bullets")}}e[s??""]=n??Ae.create()}binaryReadMap5(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ue.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.updated_walls")}}e[s??""]=n??Ue.create()}binaryReadMap7(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Me.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.updated_enemies")}}e[s??""]=n??Me.create()}binaryReadMap9(e,t,i){let s,n,r=t.uint32(),a=t.pos+r;for(;t.pos<a;){let[e,r]=t.tag();switch(e){case 1:s=t.string();break;case 2:n=Ce.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for protocol.GameStateDeltaMessage.updated_bonuses")}}e[s??""]=n??Ce.create()}internalBinaryWrite(e,t,i){for(let s of globalThis.Object.keys(e.updatedPlayers))t.tag(1,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Oe.internalBinaryWrite(e.updatedPlayers[s],t,i),t.join().join();for(let i=0;i<e.removedPlayers.length;i++)t.tag(2,A.LengthDelimited).string(e.removedPlayers[i]);for(let s of globalThis.Object.keys(e.updatedBullets))t.tag(3,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ae.internalBinaryWrite(e.updatedBullets[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.removedBullets))t.tag(4,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ae.internalBinaryWrite(e.removedBullets[s],t,i),t.join().join();for(let s of globalThis.Object.keys(e.updatedWalls))t.tag(5,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ue.internalBinaryWrite(e.updatedWalls[s],t,i),t.join().join();for(let i=0;i<e.removedWalls.length;i++)t.tag(6,A.LengthDelimited).string(e.removedWalls[i]);for(let s of globalThis.Object.keys(e.updatedEnemies))t.tag(7,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Me.internalBinaryWrite(e.updatedEnemies[s],t,i),t.join().join();for(let i=0;i<e.removedEnemies.length;i++)t.tag(8,A.LengthDelimited).string(e.removedEnemies[i]);for(let s of globalThis.Object.keys(e.updatedBonuses))t.tag(9,A.LengthDelimited).fork().tag(1,A.LengthDelimited).string(s),t.tag(2,A.LengthDelimited).fork(),Ce.internalBinaryWrite(e.updatedBonuses[s],t,i),t.join().join();0n!==e.timestamp&&t.tag(11,A.Varint).int64(e.timestamp);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},$e=new class extends Re{constructor(){super("protocol.PlayerJoinMessage",[{no:1,name:"player",kind:"message",T:()=>Oe}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();if(1===t)n.player=Oe.internalBinaryRead(e,e.uint32(),i,n.player);else{let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){e.player&&Oe.internalBinaryWrite(e.player,t.tag(1,A.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},We=new class extends Re{constructor(){super("protocol.PlayerLeaveMessage",[{no:1,name:"player_id",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.playerId="",void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();if(1===t)n.playerId=e.string();else{let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.playerId&&t.tag(1,A.LengthDelimited).string(e.playerId);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ge=new class extends Re{constructor(){super("protocol.PlayerRespawnMessage",[{no:1,name:"player_id",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.playerId="",void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();if(1===t)n.playerId=e.string();else{let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.playerId&&t.tag(1,A.LengthDelimited).string(e.playerId);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},Ke=new class extends Re{constructor(){super("protocol.ErrorMessage",[{no:1,name:"message",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.message="",void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();if(1===t)n.message=e.string();else{let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){""!==e.message&&t.tag(1,A.LengthDelimited).string(e.message);let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}},He=new class extends Re{constructor(){super("protocol.GameMessage",[{no:1,name:"type",kind:"enum",T:()=>["protocol.MessageType",xe]},{no:3,name:"input",kind:"message",oneof:"payload",T:()=>je},{no:5,name:"game_state",kind:"message",oneof:"payload",T:()=>Fe},{no:11,name:"game_state_delta",kind:"message",oneof:"payload",T:()=>Ve},{no:6,name:"player_join",kind:"message",oneof:"payload",T:()=>$e},{no:7,name:"player_leave",kind:"message",oneof:"payload",T:()=>We},{no:8,name:"player_respawn",kind:"message",oneof:"payload",T:()=>Ge},{no:10,name:"error",kind:"message",oneof:"payload",T:()=>Ke}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.type=0,t.payload={oneofKind:void 0},void 0!==e&&U(this,t,e),t}internalBinaryRead(e,t,i,s){let n=s??this.create(),r=e.pos+t;for(;e.pos<r;){let[t,s]=e.tag();switch(t){case 1:n.type=e.int32();break;case 3:n.payload={oneofKind:"input",input:je.internalBinaryRead(e,e.uint32(),i,n.payload.input)};break;case 5:n.payload={oneofKind:"gameState",gameState:Fe.internalBinaryRead(e,e.uint32(),i,n.payload.gameState)};break;case 11:n.payload={oneofKind:"gameStateDelta",gameStateDelta:Ve.internalBinaryRead(e,e.uint32(),i,n.payload.gameStateDelta)};break;case 6:n.payload={oneofKind:"playerJoin",playerJoin:$e.internalBinaryRead(e,e.uint32(),i,n.payload.playerJoin)};break;case 7:n.payload={oneofKind:"playerLeave",playerLeave:We.internalBinaryRead(e,e.uint32(),i,n.payload.playerLeave)};break;case 8:n.payload={oneofKind:"playerRespawn",playerRespawn:Ge.internalBinaryRead(e,e.uint32(),i,n.payload.playerRespawn)};break;case 10:n.payload={oneofKind:"error",error:Ke.internalBinaryRead(e,e.uint32(),i,n.payload.error)};break;default:let r=i.readUnknownField;if("throw"===r)throw new globalThis.Error(`Unknown field ${t} (wire type ${s}) for ${this.typeName}`);let a=e.skip(s);!1!==r&&(!0===r?O.onRead:r)(this.typeName,n,t,s,a)}}return n}internalBinaryWrite(e,t,i){0!==e.type&&t.tag(1,A.Varint).int32(e.type),"input"===e.payload.oneofKind&&je.internalBinaryWrite(e.payload.input,t.tag(3,A.LengthDelimited).fork(),i).join(),"gameState"===e.payload.oneofKind&&Fe.internalBinaryWrite(e.payload.gameState,t.tag(5,A.LengthDelimited).fork(),i).join(),"playerJoin"===e.payload.oneofKind&&$e.internalBinaryWrite(e.payload.playerJoin,t.tag(6,A.LengthDelimited).fork(),i).join(),"playerLeave"===e.payload.oneofKind&&We.internalBinaryWrite(e.payload.playerLeave,t.tag(7,A.LengthDelimited).fork(),i).join(),"playerRespawn"===e.payload.oneofKind&&Ge.internalBinaryWrite(e.payload.playerRespawn,t.tag(8,A.LengthDelimited).fork(),i).join(),"error"===e.payload.oneofKind&&Ke.internalBinaryWrite(e.payload.error,t.tag(10,A.LengthDelimited).fork(),i).join(),"gameStateDelta"===e.payload.oneofKind&&Ve.internalBinaryWrite(e.payload.gameStateDelta,t.tag(11,A.LengthDelimited).fork(),i).join();let s=i.writeUnknownFields;return!1!==s&&(1==s?O.onWrite:s)(this.typeName,e,t),t}};class Ye{static instance;socket=null;_gameStateHandler=null;_gameStateDeltaHandler=null;_playerJoinedHandler=null;_playerLeftHandler=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=1e3;sessionId=null;messageQueue=[];binaryMode=!0;constructor(){}static getInstance(){return Ye.instance||(Ye.instance=new Ye),Ye.instance}connect(e){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.close(),this.sessionId=e;const t=x.getInstance().getToken(),i=`${s.startsWith("https")?"wss":"ws"}://${s.replace(/^https?:\/\//,"")}/ws?sessionId=${e}&token=${t}&protocol=${this.binaryMode?"binary":"json"}`;return this.socket=new WebSocket(i),this.binaryMode&&(this.socket.binaryType="arraybuffer"),this.setupEventListeners(),this.socket}disconnect(){this.socket&&(this.socket.close(),this.socket=null,this.sessionId=null,this.messageQueue=[])}getSocket(){return this.socket}emit(e){if(!this.socket||this.socket.readyState!==WebSocket.OPEN)return console.warn("Attempting to emit without socket connection"),void this.messageQueue.push(e);this.socket.send(this.binaryMode?He.toBinary(e):He.toJsonString(e))}setupEventListeners(){this.socket&&(this.socket.onopen=()=>{for(console.log("Connected to WebSocket server"),this.reconnectAttempts=0;this.messageQueue.length>0;){const e=this.messageQueue.shift();e&&this.emit(e)}},this.socket.onclose=e=>{console.log("Disconnected from WebSocket server",e.code,e.reason),1e3!==e.code&&this.reconnectAttempts<this.maxReconnectAttempts&&this.sessionId&&(this.reconnectAttempts++,console.log(`Reconnecting... Attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts}`),setTimeout((()=>{this.sessionId&&this.connect(this.sessionId)}),this.reconnectDelay*this.reconnectAttempts))},this.socket.onerror=e=>{console.error("WebSocket error:",e)},this.socket.onmessage=e=>{try{const t=this.binaryMode?He.fromBinary(new Uint8Array(e.data)):He.fromJsonString(e.data);this.handleMessage(t)}catch(e){console.error("Failed to parse WebSocket message:",e)}})}handleMessage({payload:e}){switch(e.oneofKind){case"gameState":this._gameStateHandler?.(e.gameState);break;case"gameStateDelta":this._gameStateDeltaHandler?.(e.gameStateDelta);break;case"playerJoin":this._playerJoinedHandler?.(e.playerJoin);break;case"playerLeave":this._playerLeftHandler?.(e.playerLeave);break;default:console.warn("Unknown WebSocket event:",e.oneofKind)}}onGameState(e){this._gameStateHandler=e}onGameStateDelta(e){this._gameStateDeltaHandler=e}onPlayerJoined(e){this._playerJoinedHandler=e}onPlayerLeft(e){this._playerLeftHandler=e}}class Je{static instance;currentSession=null;socketService;constructor(){this.socketService=Ye.getInstance()}static getInstance(){return Je.instance||(Je.instance=new Je),Je.instance}async listSessions(){return await D.get("/sessions")}async startSession(e){const t=await D.post("/sessions",{name:e});return this.currentSession=t,this.socketService.connect(t.id),t}async joinSession(e){const t=await D.post(`/sessions/${e}/join`);return this.currentSession=t,this.socketService.connect(t.id),t}async deleteSession(e){await D.delete(`/sessions/${e}`),this.currentSession?.id===e&&(this.currentSession=null,this.socketService.disconnect())}async endSession(){this.currentSession&&(this.socketService.disconnect(),this.currentSession=null)}async addSessionChunks(e){if(!this.currentSession)throw new Error("No active session");return this.currentSession}async updateSessionChunk(e){return this.addSessionChunks({chunks:[e]})}async fetchSessionChunks(){if(!this.currentSession)throw new Error("No active session");const e=await D.get(`/sessions/${this.currentSession.id}/chunks`);return this.currentSession=e,e}getCurrentSession(){return this.currentSession}notifyRespawn(e){this.currentSession?this.socketService.emit({type:xe.PLAYER_RESPAWN,payload:{oneofKind:"playerRespawn",playerRespawn:Ge.create({playerId:e.id})}}):console.warn("Attempting to notify about respawn without active session")}notifyInput(e){this.socketService.emit({type:xe.INPUT,payload:{oneofKind:"input",input:e}})}onGameState(e){this.socketService.onGameState(e)}onGameStateDelta(e){this.socketService.onGameStateDelta(e)}onPlayerJoined(e){this.socketService.onPlayerJoined(e)}onPlayerLeft(e){this.socketService.onPlayerLeft(e)}}class Xe{_Player;_Enemy;_Wall;_Bonus;_OtherPlayer;_Bullet;_BulletManager;_multiplayerMode;CHUNK_SIZE=2e3;_player=null;_otherPlayers={};_enemies=[];_walls=[];_bonuses=[];_gameOver=!1;_paused=!1;floorTexture=null;chunks=new Map;generatedChunks=new Set;_cameraPoint=new i(0,0);_torchRadius=200;_debug=!1;crowdednessFactor=5;_sessionManager=Je.getInstance();_bulletManager;_lastChangesetTimestamp=0;_previousInputState={forward:!1,backward:!1,left:!1,right:!1,shoot:!1};_inputStateSubmitTimestamp=0;get debug(){return this._debug}toggleDebug(){this._debug=!this._debug}get gameOver(){return this._gameOver}get paused(){return this._paused}get player(){return this._player}get otherPlayers(){return Object.values(this._otherPlayers)}getOtherPlayerById(e){return this._otherPlayers[e]||null}get walls(){return this._walls}get enemies(){return this._enemies}get bonuses(){return this._bonuses}get cameraPoint(){return this._cameraPoint}get torchRadius(){return this._torchRadius}get multiplayerMode(){return this._multiplayerMode}constructor(e,t,i,s,n,r,a,o){this._Player=e,this._Enemy=t,this._Wall=i,this._Bonus=s,this._OtherPlayer=n,this._Bullet=r,this._BulletManager=a,this._multiplayerMode=o;const l=S.getInstance();l.loadSound(m.TORCH).then((()=>{l.playSound(m.TORCH,1,!0)})),v(g.FLOOR).then((e=>{this.floorTexture=e})),this._bulletManager=new this._BulletManager(this)}initPlayerFromSession(e){this._player=this._Player.createFromSessionPlayer(this,e)}addOtherPlayer(e){const t=new i(e.position.x,e.position.y),s=new this._OtherPlayer(this,t,e.rotation,e.id,e.username);this._otherPlayers[e.id]=s,s.applyFromGameState(e)}removeOtherPlayer(e){delete this._otherPlayers[e]}getChunkKey(e,t){return`${e},${t}`}getChunkLeftTop(e){return new i(Math.floor(e.x/this.CHUNK_SIZE),Math.floor(e.y/this.CHUNK_SIZE))}getPlayerChunkLeftTop(){return this._player?this.getChunkLeftTop(this._player.getPosition()):new i(0,0)}generateWallsForChunk(e){if(!this._player)return;const t=this.getChunkKey(e.x,e.y);this.generatedChunks.add(t);const s=e.x*this.CHUNK_SIZE,n=e.y*this.CHUNK_SIZE,r=[],a=[],o=Math.floor(Math.random()*this.crowdednessFactor)+this.crowdednessFactor,l=this._walls,h=this.torchRadius+40;for(let e=0;e<o;e++){const e=Math.random()<.5?"vertical":"horizontal";let t,o,d,c;"vertical"===e?(t=Math.floor(Math.random()*(this.CHUNK_SIZE-200)+s+100),o=Math.floor(Math.random()*(this.CHUNK_SIZE-300)+n+100),d=30,c=Math.floor(101*Math.random())+200):(t=Math.floor(Math.random()*(this.CHUNK_SIZE-300)+s+100),o=Math.floor(Math.random()*(this.CHUNK_SIZE-200)+n+100),d=Math.floor(101*Math.random())+200,c=30);const u=l.concat(r);let f=!1;for(const e of u){const i=e.getCollisionRect(),s={left:t-d/2,top:o-c/2,width:d,height:c},n=40;if(i.left<s.left+s.width+n&&i.left+i.width+n>s.left&&i.top<s.top+s.height+n&&i.top+i.height+n>s.top){f=!0;break}}if(!f){const s=new this._Wall(this,new i(t,o),d,c,e);if(s.checkCollision(this._player.x-h,this._player.y-h,2*h,2*h))continue;r.push(s);const n=new this._Enemy(this,s,l);a.push(n)}}this.chunks.set(t,{x:e.x,y:e.y,walls:r,enemies:a,bonuses:[]})}update(e){if(!this.gameOver&&!this.paused){this._player&&(this._player.update(e),this._cameraPoint=this._player.getPosition().clone());for(const t of Object.values(this._otherPlayers))t.update(e)}}endGame(){this._gameOver||(this._gameOver=!0,S.getInstance().playSound(m.GAME_OVER))}drawFloor(e){if(this.floorTexture){const t=this.floorTexture.width/2,i=this.floorTexture.height/2,s=this.cameraPoint.x%t-t,n=this.cameraPoint.y%i-i;for(let o=-720/i-1;o<a/i+2;o++)for(let a=-1280/t-1;a<r/t+2;a++)e.drawImage(this.floorTexture,-s-a*t,-n-o*i,t,i)}}draw(e,t,i){e.clearRect(0,0,r,a),this.drawFloor(e),this._walls.forEach((t=>t.draw(e,i))),this._enemies.forEach((t=>t.draw(e,i))),this._bulletManager.draw(e,i),this._bonuses.forEach((t=>t.draw(e,i))),Object.values(this._otherPlayers).forEach((t=>{t.draw(e,i)})),this._player&&this._player.draw(e,i),this.drawDarknessOverlay(t),this.drawUI(i)}drawDarknessOverlay(e){if(!this._player||!this._player.isAlive())return e.fillStyle=l,void e.fillRect(0,0,r,a);if(this._player.hasNightVision())return e.fillStyle=this._player.isNightVisionFading()?"#006000a0":"#009600a0",void e.fillRect(0,0,r,a);const t=[this._player,...this.otherPlayers.filter((e=>e.isAlive()&&!e.hasNightVision()))],i=.97*this._torchRadius+Math.random()*this._torchRadius*.06;e.fillStyle=l,e.fillRect(0,0,r,a),e.globalCompositeOperation="destination-out",t.forEach((t=>{const s=this.worldToScreenCoordinates(t.getTorchPoint()),n=e.createRadialGradient(s.x,s.y,0,s.x,s.y,i);n.addColorStop(0,"#ffffffff"),n.addColorStop(1,"#ffffff00"),e.fillStyle=n,e.fillRect(0,0,r,a),e.fillRect(0,0,r,a)})),e.globalCompositeOperation="source-over"}worldToScreenCoordinates(e){return e.movedBy(640-this._cameraPoint.x,360-this._cameraPoint.y)}handleInput(e,t){if(!this._player)return;const i=e.has("KeyW")||e.has("ArrowUp"),s=e.has("KeyS")||e.has("ArrowDown"),n=e.has("KeyA")||e.has("ArrowLeft"),r=e.has("KeyD")||e.has("ArrowRight"),a=e.has(" "),o=Date.now();(i!==this._previousInputState.forward||s!==this._previousInputState.backward||n!==this._previousInputState.left||r!==this._previousInputState.right||a!==this._previousInputState.shoot||o-this._inputStateSubmitTimestamp>1e3)&&(this._sessionManager.notifyInput({forward:i,backward:s,left:n,right:r,shoot:a}),this._previousInputState={forward:i,backward:s,left:n,right:r,shoot:a},this._inputStateSubmitTimestamp=o)}togglePause(){this._paused=!this.paused}restart(){this._sessionManager.notifyRespawn(this._player)}drawUI(e){this._player&&(e.textAlign="left",this.gameOver?(e.fillStyle="white",e.font="48px Rubik Distressed",e.textAlign="center",e.fillText("Game Over",640,360),e.font=`24px ${o}`,e.fillStyle="yellow",e.fillText(`Your posthumous royalties: ${this._player.money.toFixed(0)}$`,640,400),e.fillStyle="magenta",e.fillText("Press R to Restart",640,440)):(e.fillStyle="white",e.font=`22px ${o}`,e.fillText(`Lives: ${Array(this._player.lives).fill("").join(" ")}`,10,30),e.fillStyle="yellow",e.fillText(`Rewards: ${this._player.money.toFixed(0)}$`,10,60),e.fillStyle="cyan",e.fillText(`Bullets: ${Array(this._player.bulletsLeft).fill("").join("")}`,10,90),this._player.hasNightVision()&&(e.fillStyle="#90ff90",e.fillText(`Night Vision: ${this._player.nightVisionTimer.toFixed(0)}`,10,120))),this._player.drawUI(e),this.debug&&(e.fillStyle="white",e.font=`12px ${o}`,e.fillText(`Chunk: ${this.getChunkLeftTop(this.cameraPoint)}`,10,668),e.fillText(`Number of world objects: ${T.objectCount}`,10,654),e.fillText(`Camera position: ${this.cameraPoint}`,10,640),e.fillText(`Number of chunks: ${this.chunks.size}`,10,626),e.fillText(`Host: ${this._sessionManager.getCurrentSession()?.host.username}`,10,612),e.fillText(`Session ID: ${this._sessionManager.getCurrentSession()?.id}`,10,598),e.fillText(`Session: ${this._sessionManager.getCurrentSession()?.name}`,10,584)))}applyGameState(e){for(const t of Object.values(e.players))t.id!==this._player?.id?this._otherPlayers[t.id]||this.addOtherPlayer(t):this._player.applyFromGameState(t);for(const t of Object.values(e.walls))this._walls.find((e=>e.id===t.id))||this._walls.push(new this._Wall(this,new i(t.position.x,t.position.y),t.width,t.height,t.orientation,t.id));for(const t of Object.values(e.enemies)){const e=this._enemies.find((e=>e.id===t.id));e?e.applyFromGameState(t):this._enemies.push(new this._Enemy(this,this._walls.find((e=>e.id===t.wallId)),[],t.id))}for(const t of Object.values(e.bonuses))this._bonuses.find((e=>e.id===t.id))||this._bonuses.push(new this._Bonus(this,new i(t.position.x,t.position.y),t.type,t.id))}applyGameStateDelta(e){if(e.timestamp<=this._lastChangesetTimestamp)return void console.log(`Ignoring out-of-order changeset. Last: ${this._lastChangesetTimestamp}, Received: ${e.timestamp}`,e);this._lastChangesetTimestamp=Number(e.timestamp);const t=!!this._player&&0===this._player.bulletsLeft;for(const t of Object.values(e.updatedPlayers))t.id!==this._player?.id?this._otherPlayers[t.id]?this._otherPlayers[t.id].applyFromGameState(t):this.addOtherPlayer(t):(t.isAlive&&!this._player.isAlive()&&(S.getInstance().playSound(m.SPAWN),this._gameOver=!1),this._player.applyFromGameState(t));for(const t of e.removedPlayers)this.removeOtherPlayer(t);for(const t of Object.values(e.updatedWalls))this._walls.find((e=>e.id===t.id))||this._walls.push(new this._Wall(this,new i(t.position.x,t.position.y),t.width,t.height,t.orientation,t.id));for(const t of e.removedWalls)this._walls=this._walls.filter((e=>e.id!==t));for(const t of Object.values(e.updatedEnemies)){const e=this._enemies.find((e=>e.id===t.id));if(e)e.applyFromGameState(t);else{const e=this._walls.find((e=>e.id===t.wallId));if(!e){console.log(`Error: Wall ${t.wallId} is undefined for Enemy ${t.id}`);continue}this._enemies.push(new this._Enemy(this,e,[],t.id))}}for(const t of e.removedEnemies)this._enemies=this._enemies.filter((e=>e.id!==t));for(const t of Object.values(e.updatedBonuses))t.pickedUpBy?(this._bonuses=this._bonuses.filter((e=>e.id!==t.id)),t.pickedUpBy===this._player?.id&&S.getInstance().playSound(m.BONUS_PICKUP)):this._bonuses.find((e=>e.id===t.id))||this._bonuses.push(new this._Bonus(this,new i(t.position.x,t.position.y),t.type,t.id));for(const s of Object.values(e.updatedBullets)){const e=this._bulletManager.getBulletById(s.id);e?e.getPosition().setTo(s.position.x,s.position.y):(s.ownerId===this._player?.id&&t&&0===this._player.bulletsLeft&&S.getInstance().playSound(m.PLAYER_BULLET_RECHARGE,.5),this._bulletManager.registerShot(new this._Bullet(this,new i(s.position.x,s.position.y),0,s.isEnemy,s.ownerId,s.id)))}for(const i of Object.values(e.removedBullets))this._bulletManager.getBulletById(i.id)?this._bulletManager.unregisterShot(i.id):(S.getInstance().playSound(m.BULLET),i.ownerId===this._player?.id&&t&&0===this._player.bulletsLeft&&S.getInstance().playSound(m.PLAYER_BULLET_RECHARGE,.5))}}class qe extends T{world;_name;_image=null;_bloodImage=null;_rotation=0;_bullets=[];_invulnerableTimer=0;_lives=5;_nightVisionTimer=0;dead=!1;get rotation(){return this._rotation}get nightVisionTimer(){return this._nightVisionTimer}get name(){return this._name}constructor(e,t,i,s,n){super(t,24,24,s),this.world=e,this._name=n,this._rotation=i;const r=S.getInstance();r.loadSound(m.BULLET),r.loadSound(m.PLAYER_HURT),r.loadSound(m.PLAYER_BULLET_RECHARGE),v(g.PLAYER).then((e=>{this._image=e})),v(g.BLOOD).then((e=>{this._bloodImage=e}))}getGunPoint(){return this.getPosition().movedByPointCoordinates(h.inverted()).moveByPointCoordinates(d).rotateAroundPointCoordinates(this.getPosition(),this._rotation)}moveTo(e){this._point.setToPointCoordinates(e)}rotate(e){this._rotation=e}update(e){this._invulnerableTimer>0&&(this._invulnerableTimer=Math.max(0,this._invulnerableTimer-e))}draw(e,t){if(this._bullets.forEach((i=>{i.draw(e,t)})),!this._image||!this.world.player||this.world.gameOver)return;const s=this.world.worldToScreenCoordinates(this.getPosition());let n=!0;if((!this.world.player.hasNightVision()&&this.hasNightVision()||!this.isAlive())&&(n=this.getPosition().distanceTo(this.world.player.getTorchPoint())<=this.world.torchRadius+this.width),!n)return;this.drawUI(t);const r=5*this._invulnerableTimer/1,a=r-Math.floor(r)<.5;if(e.save(),e.translate(s.x,s.y),(this.dead||!this._invulnerableTimer||a)&&!this.world.gameOver){e.rotate(this._rotation*Math.PI/180);const t=this.dead?32:64,s=this.dead?new i(-t/2,-t/2):h.inverted();this.dead&&this._bloodImage&&e.drawImage(this._bloodImage,-this.width/2,-this.height/2,this.width,this.height),!this.dead&&this._image&&e.drawImage(this._image,s.x,s.y,t,t),e.rotate(-this._rotation*Math.PI/180)}if(e.restore(),this.world.debug){t.strokeStyle="red",t.strokeRect(-this.width/2+s.x,-this.height/2+s.y,this.width,this.height),t.fillStyle="magenta",t.beginPath(),t.arc(s.x,s.y,2,0,2*Math.PI),t.fill(),t.fillStyle="magenta";const e=this.world.worldToScreenCoordinates(this.getGunPoint());t.beginPath(),t.arc(e.x,e.y,2,0,2*Math.PI),t.fill()}}isAlive(){return this._lives>0}get lives(){return this._lives}drawUI(e){const t=this.world.worldToScreenCoordinates(this.getPosition());e.font=`14px ${o}`;const i=e.measureText(this.name),s=i.width+6,n=i.actualBoundingBoxAscent+6;e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(t.x-s/2,t.y+this.height/2+30,s,n),e.fillStyle="white",e.textAlign="center",e.fillText(this.name,t.x,t.y+this.height/2+30+i.actualBoundingBoxAscent+3)}isInvulnerable(){return this._invulnerableTimer>0}addNightVision(){this._nightVisionTimer=20}hasNightVision(){return!1}isNightVisionFading(){return!1}getTorchPoint(){return this.getPosition().movedByPointCoordinates(h.inverted()).moveByPointCoordinates(c).rotateAroundPointCoordinates(this.getPosition(),this._rotation)}applyFromGameState(e){this._point.setTo(e.position.x,e.position.y),this._rotation=e.rotation,this._lives=e.lives,this.dead=!e.isAlive,this._invulnerableTimer=e.invulnerableTimer,this._nightVisionTimer=e.nightVisionTimer}}class Ze{world;_bullets=new Map;get bullets(){return Array.from(this._bullets.values())}constructor(e){this.world=e}registerShot(e){this._bullets.set(e.id,e);const t=e.getPosition().distanceTo(this.world.player.getPosition()),i=2*this.world.torchRadius,s=t>=i?0:1-t/i;S.getInstance().playSound(m.BULLET,s)}unregisterShot(e){this._bullets.delete(e)}getBulletById(e){return this._bullets.get(e)||null}draw(e,t){this.bullets.filter((e=>e.active)).forEach((i=>i.draw(e,t)))}}class ze{_canvas;_lightCanvas;_uiCanvas;_ctx;_lightCtx;_uiCtx;_lastTime=0;_world=null;_activeKeys=new Set;_authManager;_sessionManager;_started=!1;get world(){return this._world}constructor(){this._canvas=document.getElementById("gameCanvas"),this._lightCanvas=document.getElementById("lightCanvas"),this._uiCanvas=document.getElementById("uiCanvas"),[this._canvas,this._lightCanvas,this._uiCanvas].forEach((e=>{e.width=r,e.height=a})),this._ctx=this._canvas.getContext("2d"),this._lightCtx=this._lightCanvas.getContext("2d"),this._uiCtx=this._uiCanvas.getContext("2d"),this._authManager=x.getInstance(),this._sessionManager=Je.getInstance(),this.setupEventListeners()}static async loadResources(){const e=S.getInstance();await Promise.all([v(g.FLOOR),v(g.PLAYER),v(g.ENEMY),v(g.WALL),e.loadSound(m.PLAYER_HURT),e.loadSound(m.PLAYER_DEAD),e.loadSound(m.ENEMY_HURT),e.loadSound(m.TORCH)]),e.loadSound(m.PLAYER_BULLET_RECHARGE),e.loadSound(m.BONUS_PICKUP),e.loadSound(m.GAME_OVER),e.loadSound(m.BULLET),e.loadSound(m.SPAWN),v(g.BLOOD),v(g.AID_KIT),v(g.GOGGLES)}setupEventListeners(){window.addEventListener("keydown",(e=>{this._activeKeys.add(e.key),this.handleKeyDown(e)})),window.addEventListener("keyup",(e=>{this._activeKeys.delete(e.key)})),window.addEventListener("mousemove",(e=>this.handleMouseMove(e))),window.addEventListener("mousedown",(e=>this.handleMouseDown(e))),this._sessionManager.onGameState((e=>{this._world&&this._world.applyGameState(e)})),this._sessionManager.onGameStateDelta((e=>{this._world&&this._world.applyGameStateDelta(e)})),this._sessionManager.onPlayerJoined((({player:e})=>{e&&this._world&&this._world.addOtherPlayer(e)})),this._sessionManager.onPlayerLeft((({playerId:e})=>{this._world&&this._world.removeOtherPlayer(e)}))}handleKeyDown(e){"p"===e.key&&this._world?.togglePause(),"F3"===e.key&&this._world?.toggleDebug(),["r","R"].includes(e.key)&&this._world?.gameOver&&this._world?.restart()}handleMouseMove(e){const t=this._canvas.getBoundingClientRect();e.clientX,t.left,e.clientY,t.top}handleMouseDown(e){if(0===e.button){const t=this._canvas.getBoundingClientRect();e.clientX,t.left,e.clientY,t.top}}async start(e){if(e){const t=this._authManager.getUserData(),i=e.host&&t&&e.host.id===t.id?"host":"guest";this._world=new Xe(P,L,R,I,qe,N,Ze,i),this._world.initPlayerFromSession(e.players[t.id]),this._started=!0,requestAnimationFrame((e=>this.gameLoop(e)))}}gameLoop(e){if(!this._started)return;const t=(e-this._lastTime)/1e3;this._lastTime=e,this._world?.handleInput(this._activeKeys,t),this._world?.update(t),this.draw(),requestAnimationFrame((e=>this.gameLoop(e)))}stop(){this._started=!1,S.getInstance().stopAllSounds()}draw(){[this._ctx,this._uiCtx,this._lightCtx].forEach((e=>{e.clearRect(0,0,this._canvas.width,this._canvas.height)})),this._world?.draw(this._ctx,this._lightCtx,this._uiCtx)}}class Qe{static instance;leaderboardData=[];constructor(){}static getInstance(){return Qe.instance||(Qe.instance=new Qe),Qe.instance}async getLeaderboard(){const e=await D.get("/leaderboard/global");return this.leaderboardData=e,e}getCurrentLeaderboard(){return this.leaderboardData}async refreshLeaderboard(){return this.getLeaderboard()}}const et=x.getInstance(),tt=Qe.getInstance(),it=Je.getInstance();let st=null;function nt(e){return document.getElementById(e)}function rt(){const e=window.location.pathname.match(/^\/([a-f0-9-]+)$/i);return e?e[1]:null}function at(e){window.history.pushState({},"",`${e}`)}function ot(){window.history.pushState({},"","")}function lt(e){document.querySelectorAll(".screen").forEach((e=>{e.style.setProperty("display","none")})),nt(e+"Screen")?.style.setProperty("display","flex")}function ht(e){const t=nt("leaderboardList");t&&(0!==e.length?t.innerHTML=e.slice(0,10).map(((e,t)=>`\n            <li class="leaderboard-item">\n                <span class="rank">#${t+1}</span> \n                <span class="username">${e.username}</span> \n                <span class="session">For the battle at ${e.sessionName}</span>\n                <span class="score">${e.score}</span>\n            </li>\n        `)).join(""):t.innerHTML='<li class="leaderboard-empty">No scores yet. Be the first!</li>')}function dt(e){const t=nt("sessionsList");if(!t)return;if(0===e.length)return void(t.innerHTML='<li class="sessions-empty">No active sessions</li>');const i=et.getUserData()?.id;t.innerHTML=e.map((e=>{const t=Object.keys(e.players).length,s=e.max_players||4,n=e.host.id===i,r=`<button ${n?"":'disabled title="You must be the host to delete this session"'} class="session-delete" data-session-id="${e.id}" onclick="event.stopPropagation()"></button>`;return`\n                <li class="session-item" data-session-id="${e.id}">\n                    <div class="session-info">\n                        <span class="session-name">"${e.name}"<span class="session-host">${n?"You":e.host.username}</span></span>\n                        <span class="session-players">${t}/${s}</span>\n                    </div>\n                    ${r}\n                </li>\n            `})).join(""),t.querySelectorAll(".session-item").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.dataset.sessionId;if(t){st=new ze;try{const e=await it.joinSession(t);at(t),await st.start(e),lt("game")}catch(e){console.error("Failed to join session:",e);const t=document.querySelector("#leaderboardScreen .error");t&&(t.textContent="Failed to join session. Please try again.",t.style.setProperty("display","block"))}}}))})),t.querySelectorAll(".session-delete").forEach((e=>{e.addEventListener("click",(async t=>{t.stopPropagation();const i=e.dataset.sessionId;if(i&&confirm("Are you sure you want to delete this session?"))try{await it.deleteSession(i),dt(await it.listSessions())}catch(e){console.error("Failed to delete session:",e);const t=document.querySelector("#leaderboardScreen .error");t&&(t.textContent="Failed to delete session. Please try again.",t.style.setProperty("display","block"))}}))}))}window.onload=async()=>{try{et.initToken(),await et.checkAuthStatus(),await ze.loadResources();const e=rt();if(e)try{st=new ze;const t=await it.joinSession(e);return await st.start(t),void lt("game")}catch(e){console.error("Failed to join session from URL:",e),ot()}const[t,i]=await Promise.all([tt.getLeaderboard(),it.listSessions()]);ht(t),dt(i),lt("leaderboard"),nt("username").textContent=et.getUserData().username}catch(e){console.error(e),function(){const e=nt("loader");e&&e.style.setProperty("display","none")}(),function(){const e=nt("loginButton");e&&e.style.setProperty("display","flex")}()}},nt("loginButton")?.addEventListener("click",(async()=>{if(!et.isPerformingRequest())try{await et.getAuthUrl(),et.openAuthPage()}catch(e){console.error("Authentication failed:",e)}})),nt("sessionsTab")?.addEventListener("click",(()=>{nt("sessionsTab")?.classList.add("active"),nt("leaderboardTab")?.classList.remove("active");const e=nt("sessions"),t=nt("leaderboard");e&&(e.style.display="block"),t&&(t.style.display="none")})),nt("leaderboardTab")?.addEventListener("click",(()=>{nt("leaderboardTab")?.classList.add("active"),nt("sessionsTab")?.classList.remove("active");const e=nt("sessions"),t=nt("leaderboard");e&&(e.style.display="none"),t&&(t.style.display="block")})),nt("startGameButton")?.addEventListener("click",(async()=>{const e=nt("sessionNameModal"),t=nt("sessionNameInput");e&&t&&(t.value=function(){const e=["Silly","Crazy","Brave","Sneaky","Mighty","Clumsy","Epic","Fancy","Grumpy","Happy","Sleepy","Dancing","Flying","Invisible","Legendary","Mysterious","Chaotic","Funky","Bizarre","Magical"],t=["Dragon","Goblin","Wizard","Knight","Potato","Unicorn","Troll","Ninja","Pirate","Skeleton","Chicken","Banana","Mushroom","Phoenix","Penguin","Donut","Cactus","Platypus","Waffle","Pickles"],i=["Dungeon","Castle","Cave","Tower","Forest","Swamp","Mountain","Island","Kingdom","Realm","Lair","Temple","Abyss","Palace","Fortress"];return`${e[Math.floor(Math.random()*e.length)]} ${t[Math.floor(Math.random()*t.length)]} ${i[Math.floor(Math.random()*i.length)]}`}(),e.classList.add("show"),t.focus(),t.select())})),nt("cancelSessionButton")?.addEventListener("click",(()=>{const e=nt("sessionNameModal");e&&e.classList.remove("show")})),nt("createSessionButton")?.addEventListener("click",(async()=>{const e=nt("sessionNameModal"),t=nt("sessionNameInput"),i=t?.value.trim()||"";if(i){e&&e.classList.remove("show"),st&&st.stop(),st=new ze;try{const e=await it.startSession(i);at(e.id),await st.start(e),lt("game")}catch(e){if(console.error("Game initialization failed:",e),"object"==typeof e&&e&&"message"in e&&"string"==typeof e.message){const e=document.querySelector("#leaderboardScreen .error");e&&(e.textContent="There's a problem on our end. Please try again later.",e.style.setProperty("display","block"))}}}})),nt("sessionNameInput")?.addEventListener("keypress",(e=>{"Enter"===e.key&&nt("createSessionButton")?.click()})),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=nt("sessionNameModal");e?.classList.contains("show")&&e.classList.remove("show")}})),window.addEventListener("popstate",(async()=>{const e=rt();if(e)try{st&&st.stop(),st=new ze;const t=await it.joinSession(e);await st.start(t),lt("game")}catch(e){console.error("Failed to join session from URL:",e),ot(),lt("leaderboard")}else{const e=document.querySelector(".screen[style*='display: flex']");if("gameScreen"===e?.id){try{await it.endSession(),st?.stop()}catch(e){console.error("Error ending session:",e)}const[e,t]=await Promise.all([tt.getLeaderboard(),it.listSessions()]);ht(e),dt(t);const i=et.getUserData();i&&(nt("username").textContent=i.username),lt("leaderboard")}}}))})();